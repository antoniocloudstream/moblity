
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduatoria Mobilità Polizia Penitenziaria PRAP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #06b6d4;
            --secondary-dark: #0891b2;
            --accent: #ef4444;
            --accent-hover: #dc2626;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray: #6b7280;
            --light-gray: #f3f4f6;
            --dark: #1f2937;
            --darker: #111827;
            --light: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --transition-fast: 150ms ease;
            --transition-base: 200ms ease;
            --transition-slow: 300ms ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(30, 64, 175, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(239, 68, 68, 0.05) 0%, transparent 50%);
            z-index: -1;
        }

        /* Animated background particles */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            text-align: center;
            padding: 2.5rem 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.03) 10px,
                rgba(255, 255, 255, 0.03) 20px
            );
            animation: float 20s ease-in-out infinite;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.1), transparent);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.02em;
            animation: slideInDown 0.6s ease-out;
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .subtitle {
            font-size: 1.25rem;
            font-weight: 300;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            animation: slideInUp 0.6s ease-out 0.2s both;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-logo {
            display: inline-block;
            margin-bottom: 1.5rem;
            width: 90px;
            height: 90px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            padding: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
            animation: pulse 2s ease-in-out infinite;
            backdrop-filter: blur(10px);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.1));
        }

        .header-ministry {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.5px;
            animation: slideInDown 0.6s ease-out 0.1s both;
        }

        .header-department {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.3rem;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            opacity: 0.95;
            animation: slideInDown 0.6s ease-out 0.15s both;
        }

        .header-regional {
            font-size: 1rem;
            font-weight: 400;
            margin-bottom: 0.8rem;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            opacity: 0.9;
            animation: slideInDown 0.6s ease-out 0.2s both;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all var(--transition-slow);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform var(--transition-slow);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-2xl);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            animation: fadeInUp 0.4s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            transition: all var(--transition-base);
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        input[type="text"]:hover,
        input[type="number"]:hover,
        input[type="date"]:hover,
        select:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-md);
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), var(--shadow-md);
            transform: translateY(-1px);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            padding: 0.875rem 1.75rem;
            font-size: 0.975rem;
            line-height: 1.5;
            border-radius: 12px;
            transition: all var(--transition-base);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width var(--transition-slow), height var(--transition-slow);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-md);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-lg {
            padding: 1.125rem 2.25rem;
            font-size: 1.125rem;
            border-radius: 14px;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 10px;
            letter-spacing: 0.025em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
        }

        .text-center {
            text-align: center;
        }

        .mt-4 {
            margin-top: 2rem;
        }

        .mb-4 {
            margin-bottom: 2rem;
        }

        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 1px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        th, td {
            padding: 1.125rem;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        th {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(6, 182, 212, 0.1));
            color: var(--dark);
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr {
            transition: all var(--transition-base);
        }

        tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.02);
        }

        tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
            transform: scale(1.01);
        }

        tbody tr {
            animation: slideIn 0.3s ease-out;
        }

        /* Stili per il testo dettagliato nella tabella */
        .text-muted {
            color: var(--gray);
            font-size: 0.75rem;
        }

        /* Migliore gestione del testo nelle celle */
        td {
            vertical-align: top;
            line-height: 1.4;
        }

        /* Stili per celle con contenuto dettagliato */
        td[style*="min-width"] {
            word-wrap: break-word;
            hyphens: auto;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .rank {
            font-weight: 700;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--light-gray), #e5e7eb);
            margin: 0 auto;
            font-size: 1.125rem;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base);
        }

        .rank:hover {
            transform: scale(1.1);
        }

        .rank-1 {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            animation: glow 2s ease-in-out infinite;
        }

        .rank-2 {
            background: linear-gradient(135deg, #cbd5e1, #94a3b8);
            color: white;
            box-shadow: 0 0 15px rgba(148, 163, 184, 0.5);
        }

        .rank-3 {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.5);
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 30px rgba(251, 191, 36, 0.8); }
        }

        .tab-container {
            margin-bottom: 2rem;
        }

        .tab-header {
            display: flex;
            border-radius: 16px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            gap: 0.5rem;
        }

        .tab-link {
            flex: 1;
            padding: 0.875rem 1.5rem;
            cursor: pointer;
            border-radius: 12px;
            font-weight: 600;
            transition: all var(--transition-base);
            text-align: center;
            color: var(--gray);
            position: relative;
            overflow: hidden;
        }

        .tab-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: translateX(-50%);
            transition: width var(--transition-base);
        }

        .tab-link:hover {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }

        .tab-link.active {
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: var(--shadow-md);
        }

        .tab-link.active::before {
            width: 100%;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(30, 64, 175, 0.05));
            backdrop-filter: blur(10px);
            animation: slideInLeft 0.4s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-success {
            border-left-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
        }

        .alert-warning {
            border-left-color: var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
        }

        .info-box {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.75rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
        }

        .info-box:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .info-box h3 {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .info-box p {
            margin-bottom: 0.75rem;
            color: var(--dark);
            line-height: 1.7;
        }

        footer {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: white;
            text-align: center;
            padding: 3rem 1.5rem;
            margin-top: 4rem;
            position: relative;
            overflow: hidden;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), var(--secondary), transparent);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .footer-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all var(--transition-base);
            position: relative;
        }

        .footer-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width var(--transition-base);
        }

        .footer-link:hover::after {
            width: 100%;
        }

        .footer-signature {
            margin-top: 1.5rem;
            font-size: 1rem;
            opacity: 1;
            font-style: normal;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: inline-block;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.1);
            letter-spacing: 0.5px;
        }

        .badge {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 9999px;
            background: linear-gradient(135deg, var(--gray), #4b5563);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: var(--shadow-sm);
        }

        .badge-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .badge-success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .badge-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            overflow: auto;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            margin: 3% auto;
            padding: 0;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(6, 182, 212, 0.1));
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 1.75rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            font-weight: 700;
        }

        .close {
            color: var(--gray);
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: all var(--transition-base);
            line-height: 1;
            padding: 0;
            background: none;
            border: none;
        }

        .close:hover {
            color: var(--dark);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 2rem;
            max-height: calc(90vh - 200px);
            overflow-y: auto;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.05), rgba(6, 182, 212, 0.05));
            border-top: 1px solid var(--glass-border);
        }

        /* Detail view styles */
        .detail-row {
            display: flex;
            margin-bottom: 1.25rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: all var(--transition-base);
        }

        .detail-row:hover {
            background: rgba(59, 130, 246, 0.05);
            padding-left: 1rem;
            margin-left: -1rem;
            margin-right: -1rem;
            padding-right: 1rem;
            border-radius: 8px;
        }

        .detail-label {
            font-weight: 600;
            width: 35%;
            color: var(--primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            width: 65%;
            color: var(--dark);
            font-weight: 500;
        }

        /* Lock button separated from date input */
        .lock-btn-separate {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--gray);
            cursor: pointer;
            color: var(--gray);
            transition: all var(--transition-base);
            padding: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            backdrop-filter: blur(5px);
        }

        .lock-btn-separate:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--primary);
            color: var(--primary);
            transform: scale(1.05);
        }

        .lock-btn-separate.locked {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.15);
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .lock-btn-separate svg {
            width: 20px;
            height: 20px;
            transition: all var(--transition-base);
        }

        .lock-btn-separate:hover svg {
            transform: scale(1.1);
        }



        /* File input styling */
        .file-input {
            display: none;
        }
        
        /* Assicura che il label per file input si comporti come un pulsante */
        label.btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0;
            cursor: pointer;
        }

        /* Custom checkbox styling */
        input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            flex-shrink: 0;
        }

        input[type="checkbox"]:checked {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: var(--primary);
        }

        input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        input[type="checkbox"]:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }



        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: all var(--transition-base);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1.125rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
                border-radius: 16px;
            }

            .detail-row {
                flex-direction: column;
            }

            .detail-label, .detail-value {
                width: 100%;
            }

            .detail-label {
                margin-bottom: 0.5rem;
            }
            
            .tab-header {
                flex-direction: column;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
            
            table {
                font-size: 0.875rem;
            }
            
            th, td {
                padding: 0.75rem;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            /* Nascondi tutto tranne la graduatoria quando si stampa */
            .printing-graduatoria header,
            .printing-graduatoria footer,
            .printing-graduatoria .tab-header,
            .printing-graduatoria .card-header > div:last-child,
            .printing-graduatoria .alert,
            .printing-graduatoria #tab-inserimento,
            .printing-graduatoria #tab-info,
            .printing-graduatoria #tab-protocollo,
            .printing-graduatoria .btn,
            .printing-graduatoria .actions {
                display: none !important;
            }
            
            /* Mostra solo il contenuto della graduatoria */
            .container {
                margin: 0;
                padding: 20px;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                background: white;
                margin: 0;
                padding: 20px;
            }
            
            .card-header {
                border-bottom: 2px solid #333;
                padding-bottom: 15px;
                margin-bottom: 20px;
            }
            
            .card-title {
                color: #000 !important;
                -webkit-text-fill-color: #000 !important;
                font-size: 24px;
                text-align: center;
            }
            
            table {
                border: 1px solid #000;
                width: 100%;
            }
            
            th {
                background: #f0f0f0 !important;
                color: #000 !important;
                border: 1px solid #000;
                font-weight: bold;
                padding: 10px !important;
            }
            
            td {
                border: 1px solid #000;
                color: #000 !important;
                padding: 8px !important;
            }
            
            .rank {
                background: #f0f0f0 !important;
                color: #000 !important;
                box-shadow: none !important;
                animation: none !important;
            }
            
            .rank-1, .rank-2, .rank-3 {
                background: #e0e0e0 !important;
                color: #000 !important;
                font-weight: bold;
                box-shadow: none !important;
                animation: none !important;
            }
            
            /* Nascondi i pulsanti azione nella colonna */
            .printing-graduatoria td:last-child,
            .printing-graduatoria th:last-child {
                display: none !important;
            }

            /* Stili per il testo dettagliato in stampa */
            .text-muted {
                color: #666 !important;
                font-size: 0.7rem !important;
            }

            /* Assicura che le celle dettagliate siano leggibili */
            td[style*="min-width"] {
                font-size: 0.8rem !important;
                line-height: 1.2 !important;
            }
            
            /* Rimuovi animazioni e transizioni */
            * {
                animation: none !important;
                transition: none !important;
            }
            
            /* Assicurati che la modale non venga stampata */
            .modal {
                display: none !important;
            }
            
            /* Aggiungi margini per la stampa */
            @page {
                margin: 1.5cm;
                size: A4 landscape;
            }
        }

        /* Loading animation */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .loading {
            background: linear-gradient(90deg, var(--light-gray) 25%, #e0e0e0 50%, var(--light-gray) 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        /* Enhanced form styling */
        h3 {
            color: var(--dark);
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
            padding-left: 1rem;
        }

        h3::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 80%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        /* Protocol content styling */
        .protocol-content {
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .protocol-content h4 {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.15rem;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-light);
        }

        .protocol-content h5 {
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 1.05rem;
            margin: 1.5rem 0 0.5rem 0;
        }

        .protocol-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }

        .protocol-content ul {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .protocol-content li {
            margin-bottom: 0.5rem;
        }

        /* Hover effects for table buttons */
        .details-btn:hover, .edit-btn:hover, .delete-btn:hover {
            transform: translateY(-2px) scale(1.05);
        }

        /* Smooth transitions for all interactive elements */
        a, button, input, select, textarea {
            transition: all var(--transition-base);
        }

        /* Focus visible for accessibility */
        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Custom animation for success states */
        @keyframes success-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .success-animation {
            animation: success-pulse 0.5s ease-out;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#1e40af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        </div>
        <div class="header-ministry">Ministero della Giustizia</div>
        <div class="header-department">Dipartimento dell'Amministrazione Penitenziaria</div>
        <div class="header-regional">Provveditorato Regionale per la Lombardia</div>
        <h1>Mobilità Polizia Penitenziaria PRAP</h1>
        <div class="subtitle">Sistema di Gestione Graduatorie per Interpelli</div>
    </header>

    <div class="container">
        <div class="tab-container">
            <div class="tab-header">
                <div class="tab-link active" data-tab="tab-inserimento">Inserimento Candidati</div>
                <div class="tab-link" data-tab="tab-graduatoria">Graduatoria</div>
                <div class="tab-link" data-tab="tab-graduatoria-finale" id="tabGraduatoriaFinale" style="display: none;">Graduatoria Finale</div>
                <div class="tab-link" data-tab="tab-info">Informazioni</div>
                <div class="tab-link" data-tab="tab-protocollo">Protocollo d'Intesa</div>
            </div>

            <div class="tab-content active" id="tab-inserimento">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Inserimento Dati Candidato</h2>
                    </div>
                    <div class="alert alert-success">
                        <strong>Importante:</strong> Inserire la data dell'interpello per il calcolo corretto dell'anzianità di servizio.
                    </div>
                    
                    <h3 class="mt-4 mb-4">Dati Interpello</h3>
                    <form id="candidateForm">
                        <div class="form-grid">
                            <div class="form-group" style="margin-bottom: 2rem;">
                                <label for="dataInterpello"><strong>Data dell'Interpello</strong></label>
                                <div style="display: flex; gap: 10px; align-items: center; max-width: 350px;">
                                    <input type="date" id="dataInterpello" name="dataInterpello" required style="flex: 1;">
                                    <button type="button" class="lock-btn-separate" id="lockInterpelloDate" title="Blocca/Sblocca data">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" style="margin-bottom: 2rem;">
                                <label for="destinazioneRichiesta"><strong>Destinazione Richiesta</strong></label>
                                <div style="display: flex; gap: 10px; align-items: center; max-width: 400px;">
                                    <input type="text" id="destinazioneRichiesta" name="destinazioneRichiesta" required style="flex: 1;">
                                    <button type="button" class="lock-btn-separate" id="lockDestinazioneBtn" title="Blocca/Sblocca destinazione">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <h3 class="mt-4 mb-4">Dati Candidato</h3>
                        <div class="form-grid">
                            <div class="form-group" style="margin-bottom: 2rem;">
                                <label for="ruolo"><strong>Ruolo</strong></label>
                                <select id="ruolo" name="ruolo" required style="width: 100%;">
                                    <option value="">Seleziona</option>
                                    <option value="Agente">Agente</option>
                                    <option value="Agente scelto">Agente scelto</option>
                                    <option value="Assistente">Assistente</option>
                                    <option value="Assistente capo">Assistente capo</option>
                                    <option value="Assistente capo coordinatore">Assistente capo coordinatore</option>
                                    <option value="Vice Sovrintendente">Vice Sovrintendente</option>
                                    <option value="Sovrintendente">Sovrintendente</option>
                                    <option value="Sovrintendente capo">Sovrintendente capo</option>
                                    <option value="Sovrintendente capo coordinatore">Sovrintendente capo coordinatore</option>
                                    <option value="Vice Ispettore">Vice Ispettore</option>
                                    <option value="Ispettore">Ispettore</option>
                                    <option value="Ispettore capo">Ispettore capo</option>
                                    <option value="Ispettore superiore">Ispettore superiore</option>
                                    <option value="Sostituto Commissario">Sostituto Commissario</option>
                                    <option value="Sostituto Commissario coordinatore">Sostituto Commissario coordinatore</option>
                                    <option value="Vice Commissario">Vice Commissario</option>
                                    <option value="Commissario">Commissario</option>
                                    <option value="Commissario Capo">Commissario Capo</option>
                                    <option value="Dirigente Aggiunto">Dirigente Aggiunto</option>
                                    <option value="Dirigente">Dirigente</option>
                                    <option value="Primo Dirigente">Primo Dirigente</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="matricola">Matricola</label>
                                <input type="text" id="matricola" name="matricola" required>
                            </div>
                            <div class="form-group">
                                <label for="nominativo">Nominativo</label>
                                <input type="text" id="nominativo" name="nominativo" required>
                            </div>
                             <div class="form-group">
                                <label for="dataNascita">Data di Nascita</label>
                                <input type="date" id="dataNascita" name="dataNascita" required>
                            </div>
                            <div class="form-group">
                                <label for="dataAssunzione">Data Assunzione</label>
                                <input type="date" id="dataAssunzione" name="dataAssunzione" required>
                            </div>
                            <div class="form-group">
                                <label for="ruoloAnzianita">Ruolo di Anzianità</label>
                                <input type="number" id="ruoloAnzianita" name="ruoloAnzianita" min="1" step="1" required>
                                <small>(Numero progressivo - più basso = priorità maggiore a parità di punteggio)</small>
                            </div>
                            <div class="form-group">
                                <label for="istitutoAppartenenza">Istituto di Appartenenza</label>
                                <input type="text" id="istitutoAppartenenza" name="istitutoAppartenenza" required>
                            </div>
                        </div>

                        <h3 class="mt-4 mb-4">Titoli di Studio</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="titoloStudio">Titolo di Studio Principale</label>
                                <select id="titoloStudio" name="titoloStudio" required>
                                    <option value="">Seleziona</option>
                                    <option value="4.50">Laurea vecchio ordinamento o Laurea Specialistica</option>
                                    <option value="4.00">Laurea triennale</option>
                                    <option value="3.00">Maturità o diploma professionale</option>
                                    <option value="1.50">Qualifica professionale</option>
                                    <option value="1.00">Licenza media</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dottorato">Dottorato di Ricerca</label>
                                <select id="dottorato" name="dottorato">
                                    <option value="0">No</option>
                                    <option value="1.00">Sì</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="masterII">Numero Master di II Livello (max 3)</label>
                                <input type="number" id="masterII" name="masterII" min="0" max="3" step="1" value="0">
                                <small>(0,50 punti per master)</small>
                            </div>
                            <div class="form-group">
                                <label for="masterI">Numero Master di I Livello (max 3)</label>
                                <input type="number" id="masterI" name="masterI" min="0" max="3" step="1" value="0">
                                <small>(0,30 punti per master)</small>
                            </div>
                        </div>

                        <h3 class="mt-4 mb-4">Esperienza - Attestati - Cause di servizio e Giudizi</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="anniEsperienza">Anni di Esperienza Specifica nell'Incarico</label>
                                <input type="number" id="anniEsperienza" name="anniEsperienza" min="0" max="10" step="1" value="0">
                                <small>(Max 10 anni = 2,00 punti)</small>
                            </div>
                            <div class="form-group">
                                <label for="attestatiCorsi">Numero Attestati di Corsi (max 5)</label>
                                <input type="number" id="attestatiCorsi" name="attestatiCorsi" min="0" max="5" step="1" value="0">
                                <small>(0,05 punti per attestato, max 0,25)</small>
                            </div>
                            <div class="form-group">
                                <label for="servizioNonIncompatibile">Causa di Servizio non Incomp.(max 3)</label>
                                <select id="servizioNonIncompatibile" name="servizioNonIncompatibile">
                                    <option value="0">No</option>
                                    <option value="0.25">Minimo (0,25 punti)</option>
                                    <option value="0.50">Medio (0,50 punti)</option>
                                    <option value="0.75">Massimo (0,75 punti)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="giudizioAnno1">Giudizio Anno 1</label>
                                <select id="giudizioAnno1" name="giudizioAnno1">
                                    <option value="0">Seleziona</option>
                                    <option value="0.30">Ottimo +</option>
                                    <option value="0.25">Ottimo</option>
                                    <option value="0.20">Distinto</option>
                                    <option value="0.10">Buono</option>
                                    <option value="0">Inferiore a Buono</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="giudizioAnno2">Giudizio Anno 2</label>
                                <select id="giudizioAnno2" name="giudizioAnno2">
                                    <option value="0">Seleziona</option>
                                    <option value="0.30">Ottimo +</option>
                                    <option value="0.25">Ottimo</option>
                                    <option value="0.20">Distinto</option>
                                    <option value="0.10">Buono</option>
                                    <option value="0">Inferiore a Buono</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="giudizioAnno3">Giudizio Anno 3</label>
                                <select id="giudizioAnno3" name="giudizioAnno3">
                                    <option value="0">Seleziona</option>
                                    <option value="0.30">Ottimo +</option>
                                    <option value="0.25">Ottimo</option>
                                    <option value="0.20">Distinto</option>
                                    <option value="0.10">Buono</option>
                                    <option value="0">Inferiore a Buono</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="mt-4 mb-4">Patenti (per Nuclei Traduzioni)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="patenteA" class="d-flex align-items-center">
                                    <input type="checkbox" id="patenteA" name="patenteA" style="margin-right: 8px;">
                                    <span>Patente A (0,25 punti)</span>
                                </label>
                                <small>Accessoria, cumulabile con B, C o D</small>
                            </div>
                            <div class="form-group">
                                <label for="patenteB" class="d-flex align-items-center">
                                    <input type="checkbox" id="patenteB" name="patenteB" style="margin-right: 8px;">
                                    <span>Patente B (1,00 punti)</span>
                                </label>
                                <small>Non cumulabile con C o D</small>
                            </div>
                            <div class="form-group">
                                <label for="patenteC" class="d-flex align-items-center">
                                    <input type="checkbox" id="patenteC" name="patenteC" style="margin-right: 8px;">
                                    <span>Patente C (1,50 punti)</span>
                                </label>
                                <small>Non cumulabile con B o D</small>
                            </div>
                            <div class="form-group">
                                <label for="patenteD" class="d-flex align-items-center">
                                    <input type="checkbox" id="patenteD" name="patenteD" style="margin-right: 8px;">
                                    <span>Patente D (2,00 punti)</span>
                                </label>
                                <small>Non cumulabile con B o C</small>
                            </div>
                            <div class="form-group">
                                <label for="patenteE" class="d-flex align-items-center">
                                    <input type="checkbox" id="patenteE" name="patenteE" style="margin-right: 8px;">
                                    <span>Patente E (0,25 punti)</span>
                                </label>
                                <small>Accessoria, cumulabile con B, C o D</small>
                            </div>
                        </div>

                        <div class="actions">
                            <button type="button" class="btn" id="resetBtn">Annulla</button>
                            <button type="submit" class="btn btn-success">Aggiungi Candidato</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="tab-content" id="tab-graduatoria">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Graduatoria Candidati</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" id="newCandidateBtn">Nuovo Inserimento</button>
                            <button class="btn btn-danger" id="resetGraduatoriaBtn">Reset Graduatoria</button>
                            <button class="btn btn-warning" id="exportPdfBtn">Esporta PDF</button>
                            <button class="btn btn-success" id="exportExcelBtn">Esporta Excel</button>
                            <button class="btn btn-primary" id="exportJsonBtn">Esporta</button>
                            <label for="importJsonInput" class="btn btn-primary" style="margin: 0; position: relative;" title="Seleziona uno o più file JSON da importare">
                                Importa 
                                <span style="font-size: 0.75rem; position: absolute; top: -8px; right: -8px; background: var(--accent); color: white; border-radius: 50%; padding: 2px 6px; font-weight: bold;">+</span>
                            </label>
                            <input type="file" id="importJsonInput" class="file-input" accept=".json" multiple>
                        </div>
                    </div>
                    <div class="alert alert-warning" id="noDataAlert">
                        <strong>Attenzione!</strong> Non è stato ancora inserito alcun candidato.
                    </div>
                    <div class="table-container" id="tableContainer" style="display: none;">
                        <table id="candidateTable">
                            <thead>
                                <tr>
                                    <th>Pos.</th>
                                    <th>Matricola</th>
                                    <th>Nominativo</th>
                                    <th>Ruolo</th>
                                    <th>Istituto di Appartenenza</th>
                                    <th>Titoli di Studio</th>
                                    <th>Esperienza</th>
                                    <th>Cause di Servizio</th>
                                    <th>Attestati</th>
                                    <th>Giudizi</th>
                                    <th>Anzianità</th>
                                    <th>Patenti</th>
                                    <th>Punteggio Totale</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="candidateTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-graduatoria-finale">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Graduatoria Finale (con Colloquio PRAP)</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-warning" id="exportPdfFinaleBtn">Esporta PDF Finale</button>
                            <button class="btn btn-success" id="exportExcelFinaleBtn">Esporta Excel Finale</button>
                        </div>
                    </div>
                    <div class="alert alert-warning" id="noDataFinaleAlert">
                        <strong>Attenzione!</strong> Non ci sono candidati con punteggio colloquio inserito.
                    </div>
                    <div class="table-container" id="tableFinaleContainer" style="display: none;">
                        <table id="candidateFinaleTable">
                            <thead>
                                <tr>
                                    <th>Pos.</th>
                                    <th>Matricola</th>
                                    <th>Nominativo</th>
                                    <th>Ruolo</th>
                                    <th>Istituto di Appartenenza</th>
                                    <th>Punteggio Totale Finale</th>
                                </tr>
                            </thead>
                            <tbody id="candidateFinaleTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-info">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Informazioni sul Sistema</h2>
                    </div>
                    <div class="info-box">
                        <h3>Criteri di mobilità del personale (Art. 15)</h3>
                        <p>Il presente sistema è basato sulle disposizioni dell'Art. 15 riguardante i "Criteri di mobilità del personale per la copertura dei posti a carica fissa" del D.P.R. del 15 febbraio 1999, n. 82 e successive modifiche.</p>
                        <p>L'assegnazione ai posti di servizio avviene mediante interpello, tenendo conto di diversi fattori come titoli di studio, esperienza specifica, anzianità di servizio e giudizi annuali.</p>
                    </div>
                    <div class="info-box">
                        <h3>Sistema di Punteggio</h3>
                        <p><strong>Titoli di Studio:</strong> Fino a 4,50 punti per la laurea specialistica, più eventuali punti aggiuntivi per dottorati e master.</p>
                        <p><strong>Esperienza:</strong> 0,20 punti per ogni anno di esperienza specifica nell'incarico (fino a un massimo di 2,00 punti).</p>
                        <p><strong>Giudizi Annuali:</strong> Fino a 0,30 punti per giudizio annuale "Ottimo +" (media degli ultimi 3 anni).</p>
                        <p><strong>Anzianità di Servizio:</strong> 0,30 punti per ciascun anno di servizio, calcolata dalla data di assunzione alla data dell'interpello.</p>
                        <p><strong>Patenti:</strong> Le patenti B (1,00 punto), C (1,50 punti) e D (2,00 punti) non sono cumulabili tra loro - viene considerata solo la patente con il punteggio più alto. Le patenti A (0,25 punti) ed E (0,25 punti) sono accessorie e sempre cumulabili con B, C o D.</p>
                    </div>
                    <div class="info-box">
                        <h3>Note Importanti</h3>
                        <p>I candidati che hanno riportato un giudizio complessivo inferiore a "buono" nell'ultimo triennio o sanzioni disciplinari gravi non sono ammessi agli interpelli.</p>
                        <p>L'assegnazione conclusiva all'incarico è subordinata al superamento di un periodo effettivo di prova fissato in due mesi, prorogabile per un altro mese.</p>
                        <p>Il dipendente assegnato a seguito di interpello è obbligato ad assicurare un periodo minimo di 3 anni di permanenza nel posto di servizio.</p>
                        <p><strong>Importazione Multi-file:</strong> È possibile importare più file JSON contemporaneamente. Il sistema può unire i candidati importati con quelli esistenti o sostituire l'intera graduatoria. I candidati duplicati (stessa matricola) vengono automaticamente rimossi.</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-protocollo">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Protocollo d'Intesa Regionale</h2>
                    </div>
                    <div class="info-box">
                        <h3>PROTOCOLLO D'INTESA REGIONALE PER IL PERSONALE NON DIRIGENTE APPARTENENTE AL CORPO DI POLIZIA PENITENZIARIA</h3>
                        <p><strong>Stipulato ai sensi dell'art. 3 dell'Accordo Nazionale Quadro di Amministrazione 2002-2005</strong></p>
                    </div>
                    
                    <div class="protocol-content" style="max-height: 600px; overflow-y: auto; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 8px;">
                        <h4>CAPO I - DISPOSIZIONI GENERALI</h4>
                        
                        <h5>Art. 1 - Fonti Normative</h5>
                        <p>Il presente Protocollo di Intesa è stipulato ai sensi dell'art. 3, commi 1, 2, 3 dell'Accordo Quadro d'Amministrazione per il personale appartenente al Corpo di Polizia Penitenziaria, sottoscritto in data 24 marzo 2004.</p>
                        
                        <h5>Art. 2 - Sedi di contrattazione decentrata periferica</h5>
                        <p>Ai fini del presente accordo sono sedi di contrattazione decentrata, per il personale che vi presta servizio e con esclusione del personale dell'area negoziale della dirigenza di cui all'art. 46 del D. Lgs. n. 95 del 2017, le seguenti:</p>
                        <ul>
                            <li>Il Provveditorato Regionale dell'Amministrazione Penitenziaria della Lombardia;</li>
                            <li>Gli Istituti penitenziari rientranti nel distretto del predetto Provveditorato.</li>
                        </ul>
                        
                        <h5>Art. 3 - Ambito di applicazione</h5>
                        <p>Il Protocollo è finalizzato ad attuare una progressiva uniformità dei previsti istituti contrattuali nelle strutture e nei servizi del Provveditorato Regionale dell'Amministrazione Penitenziaria della Lombardia.</p>
                        
                        <h5>Art. 4 - Sistema delle Relazioni Sindacali</h5>
                        <p>Così come indicato all'art. 23 del D.P.R. 164/2002 e all'art. 2 dell'A.Q.N. il sistema delle relazioni sindacali deve essere orientato al rispetto delle prerogative e responsabilità sia dell'Amministrazione che delle Organizzazioni Sindacali.</p>
                        
                        <h5>Art. 5 - Informazione preventiva</h5>
                        <p>L'informativa preventiva è fornita con congruo anticipo, ove possibile, in rapporto alle preminenti esigenze dell'Amministrazione, almeno sette giorni prima del previsto incontro.</p>
                        
                        <h4>CAPO II - IMPIEGO DEL PERSONALE DEL CORPO DI POLIZIA PENITENZIARIA NEI SERVIZI</h4>
                        
                        <h5>Art. 9 - Articolazione dei turni di servizio</h5>
                        <p>In sede di contrattazione decentrata locale è definita l'articolazione e la flessibilità dell'orario di lavoro che è funzionale ad assicurare il corretto svolgimento dei servizi istituzionali, il mantenimento dell'ordine e della sicurezza e il regolare svolgimento delle attività trattamentali e dell'attività amministrativa degli uffici.</p>
                        
                        <h5>Art. 10 - Criteri per l'impiego del personale nei turni festivi, serali e notturni</h5>
                        <p>La ripartizione dei turni serali e notturni festivi, domenicali ed infrasettimanali, dovrà essere effettuata, tenendo conto delle esigenze di servizio, ispirandosi a criteri di equaglianza, pari opportunità e proporzionalità tra il personale impiegato nei servizi a turno.</p>
                        
                        <h5>Art. 11 - Prestazioni di lavoro straordinario</h5>
                        <p>Ogni anno, sulla base del budget disponibile nel distretto, il Provveditore ripartisce i fondi a favore degli Istituti e Servizi dipendenti, sulla base dei criteri di cui all'art. 10, comma 4 dell'A.Q.N.</p>
                        
                        <h5>Art. 12 - Criteri generali per la programmazione di turni di reperibilità</h5>
                        <p>Il Provveditorato, sentite le organizzazioni sindacali, assegna i turni mensili di reperibilità ai sensi dell'art. 12 comma 3 dell'A.Q.N., tenendo conto dei livelli di sicurezza degli istituti, del numero e tipologia dei detenuti, dei circuiti penitenziari, delle carenze di personale rispetto all'organico fissato dall'Amministrazione Centrale.</p>
                        
                        <h5>Art. 13 - Personale con oltre cinquanta anni di età o trenta anni di servizio</h5>
                        <p>Fermo restando quanto disposto dall'art. 9, comma 3 lett. c) dell'A.Q.N. è demandata alla contrattazione decentrata l'individuazione delle modalità di impiego del predetto personale nel rispetto, per ragioni di omogeneità tra gli istituti, dei seguenti principi:</p>
                        <ul>
                            <li>nei turni notturni sarà impiegato prioritariamente il personale con età anagrafica inferiore ai 50 anni e con anzianità di servizio inferiore ai 30 anni o coloro i quali, pur avendo superato i predetti limiti, non hanno fatto richiesta di esenzione;</li>
                            <li>il personale che ha superato 50 anni di età ovvero maturato oltre 30 anni di servizio che non ha fatto richiesta di esenzione verrà impiegato, ove possibile, solo dopo che il restante personale abbia già assicurato il tetto massimo di turni notturni previsto dall'Accordo Quadro o, se inferiore, quanto previsto a livello di contrattazione locale.</li>
                        </ul>
                        
                        <h5>Art. 14 - Pari opportunità di genere sul lavoro e nello sviluppo professionale</h5>
                        <p>Fermo restando quanto previsto dall'art. 9 A.Q.N., al fine di garantire le pari opportunità, la Direzione, dopo aver stabilito le aliquote per genere maschile e femminile del personale necessario per il corretto funzionamento dei reparti detentivi e dei servizi connessi, previo esame congiunto in sede locale, dovrà impiegare il restante personale nei vari posti di servizio secondo criteri di proporzionalità.</p>
                        
                        <h5>Art. 15 - Criteri di mobilità del personale per la copertura dei posti "a carica fissa"</h5>
                        <p>Il sistema di punteggio per gli interpelli prevede:</p>
                        <ul>
                            <li><strong>Titoli di studio:</strong>
                                <ul>
                                    <li>Laurea vecchio ordinamento o Laurea Specialistica: punti 4,50</li>
                                    <li>Laurea triennale: punti 4,00</li>
                                    <li>Maturità o diploma professionale: punti 3,00</li>
                                    <li>Qualifica professionale: punti 1,50</li>
                                    <li>Licenza media: punti 1,00</li>
                                </ul>
                            </li>
                            <li><strong>Titoli aggiuntivi (cumulabili):</strong>
                                <ul>
                                    <li>Dottorato di ricerca: punti 1,00</li>
                                    <li>Master di II Livello: punti 0,50</li>
                                    <li>Master di I Livello: punti 0,30</li>
                                </ul>
                            </li>
                            <li><strong>Esperienza specifica:</strong> punti 0,20 per anno fino ad un massimo di punti 2,00</li>
                            <li><strong>Causa di servizio non incompatibile:</strong> da un minimo di punti 0,25 ad un massimo di 0,75</li>
                            <li><strong>Attestati di corsi:</strong> punti 0,05 per ciascun titolo fino ad un massimo di punti 0,25</li>
                            <li><strong>Giudizi ultimi 3 anni:</strong> Ottimo+ (0,30), Ottimo (0,25), Distinto (0,20), Buono (0,10)</li>
                            <li><strong>Anzianità di servizio:</strong> punti 0,30 per ciascun anno</li>
                            <li><strong>Patenti (per Nuclei Traduzioni):</strong>
                                <ul>
                                    <li>Patente A: punti 0,25 (accessoria, cumulabile)</li>
                                    <li>Patente B: punti 1,00 (non cumulabile con C o D)</li>
                                    <li>Patente C: punti 1,50 (non cumulabile con B o D)</li>
                                    <li>Patente D: punti 2,00 (non cumulabile con B o C)</li>
                                    <li>Patente E: punti 0,25 (accessoria, cumulabile)</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <h5>Art. 16 - Formazione ed aggiornamento del personale</h5>
                        <p>Il Provveditore Regionale e i rappresentanti delle OO.SS. nel ritenere il personale risorsa fondamentale dell'Amministrazione Penitenziaria, concordano nel riconoscere alla formazione e all'aggiornamento un ruolo fondamentale nell'accrescimento e nella valorizzazione delle competenze.</p>
                        
                        <h5>Art. 17 - Mobilità del personale relativa al PRAP</h5>
                        <p>La mobilità temporanea del personale dall'esterno verso il Provveditorato disciplinata con il presente accordo riguarda le assegnazioni provvisorie che abbiano carattere di esclusività e continuità (cc.dd. distacchi).</p>
                        
                        <h5>Art. 18 - Assegnazioni temporanee a domanda</h5>
                        <p>Le assegnazioni temporanee a domanda sono quelle rientranti nell'ambito della previsione di cui all'art.7 del D.P.R. 16 marzo 1999 n.254, ovverosia per gravissimi motivi di carattere familiare o personale adeguatamente documentati.</p>
                        
                        <h5>Art. 19 - Assegnazioni temporanee per esigenze di servizio</h5>
                        <p>Premesso che per urgenti e imprevedibili esigenze di servizio è sempre facoltà dell'Amministrazione operare con provvedimenti temporanei spostamenti di personale di polizia penitenziaria tra istituti e servizi di propria competenza.</p>
                        
                        <h5>Art. 20 - Norma conclusiva</h5>
                        <p>Il presente Protocollo sostituisce quello precedente ed ogni altro anteriore accordo sindacale regionale sulle stesse materie, comunque denominato, che dalla data di sottoscrizione cessano di avere efficacia.</p>
                        
                        <div class="info-box" style="margin-top: 30px;">
                            <p><strong>Milano, 27 marzo 2023</strong></p>
                            <p>Per la parte pubblica: Il Provveditore Regionale Pietro Buffa</p>
                            <p>Per la parte sindacale: O.S. SAPPE, O.S. SINAPPE, O.S. OSAPP, O.S. UILPA, O.S. USPP, O.S. CISL FNS, O.S. CGIL FP PP</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Dettagli Candidato</h2>
                <span class="close" id="closeDetailsModal">&times;</span>
            </div>
            <div class="modal-body" id="detailsModalBody">
                </div>
            <div class="modal-footer">
                <button class="btn" id="closeDetailsBtn">Chiudi</button>
            </div>
        </div>
    </div>

    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Contatti</h2>
                <span class="close" id="closeContactModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="detail-row">
                    <div class="detail-label">Responsabile:</div>
                    <div class="detail-value"><strong>Ass.te Capo Coordinatore Gerardo Innamorato</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ufficio:</div>
                    <div class="detail-value">Provveditorato Regionale Amministrazione Penitenziaria<br>
                    Ufficio II - Personale e Formazione</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Indirizzo:</div>
                    <div class="detail-value">Via Pietro Azario, 6 - 20123 Milano</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Telefono:</div>
                    <div class="detail-value">02.438561-219</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Email Ufficio:</div>
                    <div class="detail-value"><a href="mailto:segreteriapersonale.cfc.pr.milano@giustizia.it">segreteriapersonale.cfc.pr.milano@giustizia.it</a></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Email Personale:</div>
                    <div class="detail-value"><a href="mailto:gerardo.innamorato@giustizia.it">gerardo.innamorato@giustizia.it</a></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeContactBtn">Chiudi</button>
            </div>
        </div>
    </div>

    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Termini di Servizio</h2>
                <span class="close" id="closeTermsModal">&times;</span>
            </div>
            <div class="modal-body">
                <h3>Termini di Servizio Generali</h3>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>1. Accettazione dei Termini</strong></div>
                    <div class="detail-value">Utilizzando questa applicazione, accetti di rispettare questi Termini di Servizio ("ToS"). Se non sei d'accordo, non utilizzare l'app.</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>2. Utilizzo dell'App</strong></div>
                    <div class="detail-value">
                        • L'app è destinata a uso personale e non commerciale, salvo diversa autorizzazione.<br>
                        • Non puoi modificare, distribuire o copiare il contenuto senza permesso.<br>
                        • Sei responsabile del tuo account e delle attività svolte tramite esso.
                    </div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>3. Privacy e Dati</strong></div>
                    <div class="detail-value">L'utilizzo dei tuoi dati è regolato dalla nostra <strong>Privacy Policy</strong>. Alcune informazioni potrebbero essere condivise con terze parti per migliorare il servizio.</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>4. Modifiche e Interruzioni</strong></div>
                    <div class="detail-value">
                        • Lo sviluppatore può modificare o interrompere l'app in qualsiasi momento.<br>
                        • I Termini di Servizio possono essere aggiornati, e l'uso continuato implica l'accettazione delle nuove condizioni.
                    </div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>5. Limitazione di Responsabilità</strong></div>
                    <div class="detail-value">L'app è fornita "così com'è". Non siamo responsabili per eventuali danni derivanti dall'uso o dall'impossibilità di usarla.</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>6. Legge Applicabile</strong></div>
                    <div class="detail-value">Questi Termini sono regolati dalle leggi del paese in cui opera lo sviluppatore dell'app.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeTermsBtn">Chiudi</button>
            </div>
        </div>
    </div>

    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Privacy Policy</h2>
                <span class="close" id="closePrivacyModal">&times;</span>
            </div>
            <div class="modal-body">
                <h3><strong>Regolamento sulla Privacy e Trattamento dei Dati</strong></h3>
                <p>L'utilizzo dei nostri servizi è soggetto alla nostra <strong>Privacy Policy</strong>, che descrive in dettaglio come raccogliamo, utilizziamo, condividiamo e proteggiamo i tuoi dati personali.</p>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>1. Raccolta dei Dati</strong></div>
                    <div class="detail-value">
                        • <strong>Dati forniti dall'utente</strong>: Nome, email, informazioni di pagamento, ecc.<br>
                        • <strong>Dati automatici</strong>: IP, cookie, dati di utilizzo dell'app, geolocalizzazione (se consentita).<br>
                        • <strong>Dati di terze parti</strong>: Se accedi tramite social network (es. Google, Facebook), potremmo ricevere alcune informazioni dal tuo profilo.
                    </div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>2. Finalità del Trattamento</strong></div>
                    <div class="detail-value">
                        I tuoi dati sono utilizzati per:<br>
                        • Fornire e migliorare i nostri servizi.<br>
                        • Personalizzare la tua esperienza.<br>
                        • Comunicare aggiornamenti o offerte (se acconsenti).<br>
                        • Rispettare obblighi legali e prevenire frodi.
                    </div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>3. Condivisione dei Dati</strong></div>
                    <div class="detail-value">
                        I tuoi dati potrebbero essere condivisi con:<br>
                        • <strong>Fornitori di servizi</strong> (hosting, pagamenti, analytics).<br>
                        • <strong>Autorità competenti</strong>, se richiesto dalla legge.<br>
                        • <strong>Partner commerciali</strong>, solo con il tuo esplicito consenso.
                    </div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>4. Diritti dell'Utente</strong></div>
                    <div class="detail-value">
                        Hai il diritto di:<br>
                        • <strong>Accedere, correggere o cancellare</strong> i tuoi dati.<br>
                        • <strong>Opporti</strong> al trattamento per marketing diretto.<br>
                        • <strong>Revocare il consenso</strong> in qualsiasi momento.<br>
                        • <strong>Richiedere la portabilità</strong> dei dati (ove applicabile).
                    </div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>5. Sicurezza</strong></div>
                    <div class="detail-value">Adottiamo misure tecniche e organizzative per proteggere i tuoi dati, ma nessun sistema è totalmente immune da rischi.</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label"><strong>6. Modifiche alla Privacy Policy</strong></div>
                    <div class="detail-value">Ci riserviamo il diritto di aggiornare questa policy. Le modifiche saranno comunicate tramite notifica in-app o via email.</div>
                </div>
                
                <p style="margin-top: 20px;"><strong>Per ulteriori dettagli, consulta l'intero documento della Privacy Policy.</strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closePrivacyBtn">Chiudi</button>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Modifica Candidato</h2>
                <span class="close" id="closeEditModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editCandidateId">
                    
                    <h3 class="mt-4 mb-4">Dati Interpello</h3>
                    <div class="form-grid">
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="editDataInterpello"><strong>Data dell'Interpello</strong></label>
                            <div style="display: flex; gap: 10px; align-items: center; max-width: 350px;">
                                <input type="date" id="editDataInterpello" name="editDataInterpello" required style="flex: 1;">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="editDestinazioneRichiesta"><strong>Destinazione Richiesta</strong></label>
                            <div style="display: flex; gap: 10px; align-items: center; max-width: 400px;">
                                <input type="text" id="editDestinazioneRichiesta" name="editDestinazioneRichiesta" required style="flex: 1;">
                            </div>
                        </div>
                    </div>

                    <h3 class="mt-4 mb-4">Dati Candidato</h3>
                    <div class="form-grid">
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="editRuolo"><strong>Ruolo</strong></label>
                            <select id="editRuolo" name="editRuolo" required style="max-width: 300px;">
                                <option value="">Seleziona</option>
                                <option value="Agente">Agente</option>
                                <option value="Agente scelto">Agente scelto</option>
                                <option value="Assistente">Assistente</option>
                                <option value="Assistente capo">Assistente capo</option>
                                <option value="Assistente capo coordinatore">Assistente capo coordinatore</option>
                                <option value="Vice Sovrintendente">Vice Sovrintendente</option>
                                <option value="Sovrintendente">Sovrintendente</option>
                                <option value="Sovrintendente capo">Sovrintendente capo</option>
                                <option value="Sovrintendente capo coordinatore">Sovrintendente capo coordinatore</option>
                                <option value="Vice Ispettore">Vice Ispettore</option>
                                <option value="Ispettore">Ispettore</option>
                                <option value="Ispettore capo">Ispettore capo</option>
                                <option value="Ispettore capo superiore">Ispettore capo superiore</option>
                                <option value="Sostituto Commissario">Sostituto Commissario</option>
                                <option value="Sostituto Commissario coordinatore">Sostituto Commissario coordinatore</option>
                                <option value="Vice Commissario">Vice Commissario</option>
                                <option value="Commissario">Commissario</option>
                                <option value="Commissario Capo">Commissario Capo</option>
                                <option value="Dirigente Aggiunto">Dirigente Aggiunto</option>
                                <option value="Dirigente">Dirigente</option>
                                <option value="Primo Dirigente">Primo Dirigente</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editMatricola">Matricola</label>
                            <input type="text" id="editMatricola" name="editMatricola" required>
                        </div>
                        <div class="form-group">
                            <label for="editNominativo">Nominativo</label>
                            <input type="text" id="editNominativo" name="editNominativo" required>
                        </div>
                        <div class="form-group">
                            <label for="editDataAssunzione">Data Assunzione</label>
                            <input type="date" id="editDataAssunzione" name="editDataAssunzione" required>
                        </div>
                        <div class="form-group">
                            <label for="editRuoloAnzianita">Ruolo di Anzianità</label>
                            <input type="number" id="editRuoloAnzianita" name="editRuoloAnzianita" min="1" step="1" required>
                            <small>(Numero progressivo - più basso = priorità maggiore a parità di punteggio)</small>
                        </div>
                        <div class="form-group">
                            <label for="editIstitutoAppartenenza">Istituto di Appartenenza</label>
                            <input type="text" id="editIstitutoAppartenenza" name="editIstitutoAppartenenza" required>
                        </div>
                        <div class="form-group">
                            <label for="editDataNascita">Data di Nascita</label>
                            <input type="date" id="editDataNascita" name="editDataNascita" required>
                        </div>
                    </div>

                    <h3 class="mt-4 mb-4">Titoli di Studio</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editTitoloStudio">Titolo di Studio Principale</label>
                            <select id="editTitoloStudio" name="editTitoloStudio" required>
                                <option value="">Seleziona</option>
                                <option value="4.50">Laurea vecchio ordinamento o Laurea Specialistica</option>
                                <option value="4.00">Laurea triennale</option>
                                <option value="3.00">Maturità o diploma professionale</option>
                                <option value="1.50">Qualifica professionale</option>
                                <option value="1.00">Licenza media</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editDottorato">Dottorato di Ricerca</label>
                            <select id="editDottorato" name="editDottorato">
                                <option value="0">No</option>
                                <option value="1.00">Sì</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editMasterII">Numero Master di II Livello (max 3)</label>
                            <input type="number" id="editMasterII" name="editMasterII" min="0" max="3" step="1" value="0">
                            <small>(0,50 punti per master)</small>
                        </div>
                        <div class="form-group">
                            <label for="editMasterI">Numero Master di I Livello (max 3)</label>
                            <input type="number" id="editMasterI" name="editMasterI" min="0" max="3" step="1" value="0">
                            <small>(0,30 punti per master)</small>
                        </div>
                    </div>

                    <h3 class="mt-4 mb-4">Esperienza e Giudizi</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editAnniEsperienza">Anni di Esperienza Specifica nell'Incarico</label>
                            <input type="number" id="editAnniEsperienza" name="editAnniEsperienza" min="0" max="10" step="1" value="0">
                            <small>(Max 10 anni = 2,00 punti)</small>
                        </div>
                        <div class="form-group">
                            <label for="editAttestatiCorsi">Numero Attestati di Corsi (max 5)</label>
                            <input type="number" id="editAttestatiCorsi" name="editAttestatiCorsi" min="0" max="5" step="1" value="0">
                            <small>(0,05 punti per attestato, max 0,25)</small>
                        </div>
                        <div class="form-group">
                            <label for="editServizioNonIncompatibile">Causa di Servizio (max 3)</label>
                            <select id="editServizioNonIncompatibile" name="editServizioNonIncompatibile">
                                <option value="0">No</option>
                                <option value="0.25">Minimo (0,25 punti)</option>
                                <option value="0.50">Medio (0,50 punti)</option>
                                <option value="0.75">Massimo (0,75 punti)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editGiudizioAnno1">Giudizio Anno 1</label>
                            <select id="editGiudizioAnno1" name="editGiudizioAnno1">
                                <option value="0">Seleziona</option>
                                <option value="0.30">Ottimo +</option>
                                <option value="0.25">Ottimo</option>
                                <option value="0.20">Distinto</option>
                                <option value="0.10">Buono</option>
                                <option value="0">Inferiore a Buono</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editGiudizioAnno2">Giudizio Anno 2</label>
                            <select id="editGiudizioAnno2" name="editGiudizioAnno2">
                                <option value="0">Seleziona</option>
                                <option value="0.30">Ottimo +</option>
                                <option value="0.25">Ottimo</option>
                                <option value="0.20">Distinto</option>
                                <option value="0.10">Buono</option>
                                <option value="0">Inferiore a Buono</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editGiudizioAnno3">Giudizio Anno 3</label>
                            <select id="editGiudizioAnno3" name="editGiudizioAnno3">
                                <option value="0">Seleziona</option>
                                <option value="0.30">Ottimo +</option>
                                <option value="0.25">Ottimo</option>
                                <option value="0.20">Distinto</option>
                                <option value="0.10">Buono</option>
                                <option value="0">Inferiore a Buono</option>
                            </select>
                        </div>
                    </div>

                        <h3 class="mt-4 mb-4">Patenti (per Nuclei Traduzioni)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editPatenteA" class="d-flex align-items-center">
                                    <input type="checkbox" id="editPatenteA" name="editPatenteA" style="margin-right: 8px;">
                                    <span>Patente A (0,25 punti)</span>
                                </label>
                                <small>Accessoria, cumulabile con B, C o D</small>
                            </div>
                            <div class="form-group">
                                <label for="editPatenteB" class="d-flex align-items-center">
                                    <input type="checkbox" id="editPatenteB" name="editPatenteB" style="margin-right: 8px;">
                                    <span>Patente B (1,00 punti)</span>
                                </label>
                                <small>Non cumulabile con C o D</small>
                            </div>
                            <div class="form-group">
                                <label for="editPatenteC" class="d-flex align-items-center">
                                    <input type="checkbox" id="editPatenteC" name="editPatenteC" style="margin-right: 8px;">
                                    <span>Patente C (1,50 punti)</span>
                                </label>
                                <small>Non cumulabile con B o D</small>
                            </div>
                            <div class="form-group">
                                <label for="editPatenteD" class="d-flex align-items-center">
                                    <input type="checkbox" id="editPatenteD" name="editPatenteD" style="margin-right: 8px;">
                                    <span>Patente D (2,00 punti)</span>
                                </label>
                                <small>Non cumulabile con B or C</small>
                            </div>
                            <div class="form-group">
                                <label for="editPatenteE" class="d-flex align-items-center">
                                    <input type="checkbox" id="editPatenteE" name="editPatenteE" style="margin-right: 8px;">
                                    <span>Patente E (0,25 punti)</span>
                                </label>
                                <small>Accessoria, cumulabile con B, C o D</small>
                            </div>
                        </div>

                        <h3 class="mt-4 mb-4">Punteggio Colloquio (riservato al PRAP)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editPunteggioColloquio">Punteggio Colloquio</label>
                                <input type="number" id="editPunteggioColloquio" name="editPunteggioColloquio" min="0" max="4" step="0.01" value="">
                                <small>(Facoltativo - Da 0 a 4,00 punti)</small>
                            </div>
                        </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelEditBtn">Annulla</button>
                <button class="btn btn-success" id="saveEditBtn">Salva Modifiche</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Sistema Gestione Graduatorie - Polizia Penitenziaria</p>
            <div class="footer-links">
                <a href="#" class="footer-link" id="privacyLink">Privacy Policy</a>
                <a href="#" class="footer-link" id="termsLink">Termini di Servizio</a>
                <a href="#" class="footer-link" id="contactLink">Contatti</a>
            </div>
            <div class="footer-signature">
                Programma creato da Gerardo Innamorato
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Gestione delle tab
            const tabLinks = document.querySelectorAll('.tab-link');
            tabLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Rimuove la classe active da tutti i tab
                    tabLinks.forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Aggiunge la classe active al tab cliccato
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Inizializzazione array candidati
            let candidates = JSON.parse(localStorage.getItem('candidates')) || [];
            let isInterpelloDateLocked = localStorage.getItem('isInterpelloDateLocked') === 'true';
            let lockedInterpelloDate = localStorage.getItem('lockedInterpelloDate') || '';
            
            // Inizializzazione variabili per destinazione richiesta
            let isDestinazioneRichiestaLocked = localStorage.getItem('isDestinazioneRichiestaLocked') === 'true';
            let lockedDestinazioneRichiesta = localStorage.getItem('lockedDestinazioneRichiesta') || '';

            // Imposta lo stato iniziale del lucchetto per la data
            const lockBtn = document.getElementById('lockInterpelloDate');
            if (isInterpelloDateLocked) {
                lockBtn.classList.add('locked');
                document.getElementById('dataInterpello').value = lockedInterpelloDate;
            }

            // Imposta lo stato iniziale del lucchetto per la destinazione
            const lockDestinazioneBtn = document.getElementById('lockDestinazioneBtn');
            if (isDestinazioneRichiestaLocked) {
                lockDestinazioneBtn.classList.add('locked');
                document.getElementById('destinazioneRichiesta').value = lockedDestinazioneRichiesta;
            }

            // Gestione del lucchetto per la data dell'interpello
            lockBtn.addEventListener('click', function() {
                const dataInterpelloInput = document.getElementById('dataInterpello');
                
                if (isInterpelloDateLocked) {
                    // Sblocca la data
                    this.classList.remove('locked');
                    isInterpelloDateLocked = false;
                    localStorage.setItem('isInterpelloDateLocked', 'false');
                } else {
                    // Blocca la data
                    if (!dataInterpelloInput.value) {
                        alert('Inserire prima una data per l\'interpello');
                        return;
                    }
                    this.classList.add('locked');
                    isInterpelloDateLocked = true;
                    lockedInterpelloDate = dataInterpelloInput.value;
                    localStorage.setItem('isInterpelloDateLocked', 'true');
                    localStorage.setItem('lockedInterpelloDate', lockedInterpelloDate);
                }
            });

            // Funzione per aggiornare la graduatoria finale
            function updateGraduatoriaFinale() {
                const candidatesWithColloquio = candidates.filter(c => c.punteggioColloquio && c.punteggioColloquio > 0);
                const tabGraduatoriaFinale = document.getElementById('tabGraduatoriaFinale');
                const tableBodyFinale = document.getElementById('candidateFinaleTableBody');
                const noDataFinaleAlert = document.getElementById('noDataFinaleAlert');
                const tableFinaleContainer = document.getElementById('tableFinaleContainer');
                
                if (candidatesWithColloquio.length === 0) {
                    // Nascondi la tab graduatoria finale
                    tabGraduatoriaFinale.style.display = 'none';
                    noDataFinaleAlert.style.display = 'block';
                    tableFinaleContainer.style.display = 'none';
                    return;
                }
                
                // Mostra la tab graduatoria finale
                tabGraduatoriaFinale.style.display = 'block';
                noDataFinaleAlert.style.display = 'none';
                tableFinaleContainer.style.display = 'block';
                
                // Svuota la tabella
                tableBodyFinale.innerHTML = '';
                
                // Ordina i candidati per punteggio totale finale (con colloquio)
                candidatesWithColloquio.sort((a, b) => {
                    if (b.punteggioTotale !== a.punteggioTotale) {
                        return b.punteggioTotale - a.punteggioTotale;
                    }
                    if (a.ruoloAnzianita !== b.ruoloAnzianita) {
                        return a.ruoloAnzianita - b.ruoloAnzianita;
                    }
                    if (b.punteggioAnzianita !== a.punteggioAnzianita) {
                        return b.punteggioAnzianita - a.punteggioAnzianita;
                    }
                    return new Date(b.dataNascita) - new Date(a.dataNascita);
                });
                
                // Popola la tabella finale
                candidatesWithColloquio.forEach((candidate, index) => {
                    const row = document.createElement('tr');
                    
                    // Classe per le prime posizioni
                    if (index < 3) {
                        row.classList.add(`top-${index + 1}`);
                    }
                    
                    row.innerHTML = `
                        <td class="text-center">
                            <div class="rank ${index < 3 ? 'rank-' + (index + 1) : ''}">${index + 1}</div>
                        </td>
                        <td>${candidate.matricola}</td>
                        <td>${candidate.nominativo}</td>
                        <td>${candidate.ruolo || ''}</td>
                        <td>${candidate.istitutoAppartenenza || ''}</td>
                        <td><strong>${candidate.punteggioTotale.toFixed(2)}</strong></td>
                    `;
                    
                    tableBodyFinale.appendChild(row);
                });
            }

            // Esporta PDF graduatoria finale
            document.getElementById('exportPdfFinaleBtn').addEventListener('click', function() {
                const candidatesWithColloquio = candidates.filter(c => c.punteggioColloquio && c.punteggioColloquio > 0);
                
                if (candidatesWithColloquio.length === 0) {
                    alert('Nessun candidato con punteggio colloquio da esportare');
                    return;
                }

                // Trova la destinazione richiesta
                const destinazione = candidatesWithColloquio.length > 0 && candidatesWithColloquio[0].destinazioneRichiesta ? 
                                   candidatesWithColloquio[0].destinazioneRichiesta : 'Interpello';
                
                // Ordina i candidati
                const sortedCandidates = [...candidatesWithColloquio].sort((a, b) => {
                    if (b.punteggioTotale !== a.punteggioTotale) {
                        return b.punteggioTotale - a.punteggioTotale;
                    }
                    if (a.ruoloAnzianita !== b.ruoloAnzianita) {
                        return a.ruoloAnzianita - b.ruoloAnzianita;
                    }
                    if (b.punteggioAnzianita !== a.punteggioAnzianita) {
                        return b.punteggioAnzianita - a.punteggioAnzianita;
                    }
                    return new Date(b.dataNascita) - new Date(a.dataNascita);
                });

                // Genera HTML per PDF graduatoria finale
                let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Graduatoria Finale per ${destinazione}</title>
                    <style>
                        * {
                            margin: 0 !important;
                            padding: 0 !important;
                            border-radius: 0 !important;
                            box-shadow: none !important;
                            background: white !important;
                            color: black !important;
                        }
                        body {
                            font-family: 'Arial Black', 'Arial', sans-serif !important;
                            font-size: 16px !important;
                            background: white !important;
                            margin: 0 !important;
                            padding: 5mm !important;
                            font-weight: bold !important;
                        }
                        .title {
                            text-align: center !important;
                            font-size: 32px !important;
                            font-weight: 900 !important;
                            margin-bottom: 8mm !important;
                            color: black !important;
                            text-transform: uppercase !important;
                            letter-spacing: 2px !important;
                            border: 3px solid black !important;
                            padding: 15px !important;
                            background: #f8f8f8 !important;
                        }
                        table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            font-size: 14px !important;
                            border: 3px solid black !important;
                            background: white !important;
                            font-weight: bold !important;
                        }
                        th {
                            border: 2px solid black !important;
                            padding: 12px !important;
                            text-align: center !important;
                            font-weight: 900 !important;
                            background: #e0e0e0 !important;
                            color: black !important;
                            font-size: 16px !important;
                            height: 30px !important;
                            text-transform: uppercase !important;
                            letter-spacing: 1px !important;
                        }
                        td {
                            border: 1.5px solid black !important;
                            padding: 10px !important;
                            font-size: 14px !important;
                            background: white !important;
                            color: black !important;
                            height: 25px !important;
                            font-weight: bold !important;
                            vertical-align: middle !important;
                        }
                        .pos { 
                            width: 10% !important; 
                            text-align: center !important;
                            font-size: 22px !important;
                            font-weight: 900 !important;
                            background: white !important;
                            color: black !important;
                        }
                        .mat { width: 15% !important; text-align: center !important; }
                        .nome { 
                            width: 25% !important; 
                            text-align: left !important;
                            font-size: 16px !important;
                        }
                        .ruolo { width: 20% !important; text-align: left !important; }
                        .ist { width: 20% !important; text-align: left !important; }
                        .tot { 
                            width: 10% !important; 
                            text-align: center !important;
                            font-size: 20px !important;
                            font-weight: 900 !important;
                            background: #f0f0f0 !important;
                        }
                        
                        tr:nth-child(even) { background: #f8f8f8 !important; }
                        tr:nth-child(odd) { background: white !important; }
                        
                        /* Tutte le righe con stesso peso del carattere */
                        tbody tr td { font-weight: 900 !important; }
                        
                        @page {
                            size: A3 landscape !important;
                            margin: 10mm !important;
                        }
                        @media print {
                            body { 
                                -webkit-print-color-adjust: exact !important;
                                color-adjust: exact !important;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="title">Graduatoria Finale per ${destinazione}</div>
                    <table>
                        <thead>
                            <tr>
                                <th class="pos">Pos.</th>
                                <th class="mat">Matricola</th>
                                <th class="nome">Nominativo</th>
                                <th class="ruolo">Ruolo</th>
                                <th class="ist">Istituto</th>
                                <th class="tot">Totale Finale</th>
                            </tr>
                        </thead>
                        <tbody>`;

                // Aggiungi ogni candidato con formato uniforme
                sortedCandidates.forEach((candidate, index) => {
                    htmlContent += `
                        <tr>
                            <td class="pos">${index + 1}</td>
                            <td class="mat">${candidate.matricola}</td>
                            <td class="nome">${candidate.nominativo}</td>
                            <td class="ruolo">${candidate.ruolo || ''}</td>
                            <td class="ist">${candidate.istitutoAppartenenza || ''}</td>
                            <td class="tot">${candidate.punteggioTotale.toFixed(2)}</td>
                        </tr>`;
                });

                htmlContent += `
                        </tbody>
                    </table>
                </body>
                </html>`;

                // Crea il blob HTML
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                // Crea nome file sicuro
                const fileName = `Graduatoria_Finale_${destinazione.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
                
                // Crea link per download
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = fileName;
                downloadLink.style.display = 'none';
                
                // Aggiungi al DOM, clicca e rimuovi
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                // Libera la memoria
                URL.revokeObjectURL(url);
                
                // Messaggio informativo per formato A3
                alert(`File HTML scaricato: "${fileName}"\n\nPer convertire in PDF:\n1. Apri il file scaricato nel browser\n2. Premi Ctrl+P (o Cmd+P su Mac)\n3. Seleziona "Salva come PDF"\n4. Assicurati che sia selezionato formato A3 Orizzontale\n5. Clicca "Salva"\n\nGraduatoria finale con punteggi colloquio inclusi.`);
            });

            // Esporta Excel graduatoria finale
            document.getElementById('exportExcelFinaleBtn').addEventListener('click', function() {
                const candidatesWithColloquio = candidates.filter(c => c.punteggioColloquio && c.punteggioColloquio > 0);
                
                if (candidatesWithColloquio.length === 0) {
                    alert('Nessun candidato con punteggio colloquio da esportare');
                    return;
                }

                // Ordina i candidati
                const sortedCandidates = [...candidatesWithColloquio].sort((a, b) => {
                    if (b.punteggioTotale !== a.punteggioTotale) {
                        return b.punteggioTotale - a.punteggioTotale;
                    }
                    if (a.ruoloAnzianita !== b.ruoloAnzianita) {
                        return a.ruoloAnzianita - b.ruoloAnzianita;
                    }
                    if (b.punteggioAnzianita !== a.punteggioAnzianita) {
                        return b.punteggioAnzianita - a.punteggioAnzianita;
                    }
                    return new Date(b.dataNascita) - new Date(a.dataNascita);
                });

                // Crea contenuto CSV per graduatoria finale
                let csvContent = "Posizione;Matricola;Nominativo;Ruolo;Istituto Appartenenza;Punteggio Totale Finale\n";

                sortedCandidates.forEach((candidate, index) => {
                    const posizione = index + 1;
                    const formatValue = (value) => `"${value}"`;

                    csvContent += `${posizione};${formatValue(candidate.matricola)};${formatValue(candidate.nominativo)};${formatValue(candidate.ruolo)};${formatValue(candidate.istitutoAppartenenza)};`;
                    csvContent += `${candidate.punteggioTotale.toFixed(2).replace('.', ',')}\n`;
                });

                // Crea il blob e il link per il download
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `graduatoria_finale_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // Gestione del lucchetto per la destinazione richiesta
            lockDestinazioneBtn.addEventListener('click', function() {
                const destinazioneInput = document.getElementById('destinazioneRichiesta');
                
                if (isDestinazioneRichiestaLocked) {
                    // Sblocca la destinazione
                    this.classList.remove('locked');
                    isDestinazioneRichiestaLocked = false;
                    localStorage.setItem('isDestinazioneRichiestaLocked', 'false');
                } else {
                    // Blocca la destinazione
                    if (!destinazioneInput.value) {
                        alert('Inserire prima una destinazione');
                        return;
                    }
                    this.classList.add('locked');
                    isDestinazioneRichiestaLocked = true;
                    lockedDestinazioneRichiesta = destinazioneInput.value;
                    localStorage.setItem('isDestinazioneRichiestaLocked', 'true');
                    localStorage.setItem('lockedDestinazioneRichiesta', lockedDestinazioneRichiesta);
                }
            });

            updateTable();
            updateGraduatoriaFinale();

            // Form di inserimento candidato
            const candidateForm = document.getElementById('candidateForm');
            candidateForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Raccolta dati form
                const matricola = document.getElementById('matricola').value;
                const nominativo = document.getElementById('nominativo').value;
                const dataAssunzione = new Date(document.getElementById('dataAssunzione').value);
                const ruoloAnzianita = parseInt(document.getElementById('ruoloAnzianita').value);
                const istitutoAppartenenza = document.getElementById('istitutoAppartenenza').value;
                const dataNascita = new Date(document.getElementById('dataNascita').value);
                const dataInterpello = new Date(document.getElementById('dataInterpello').value);
                const destinazioneRichiesta = document.getElementById('destinazioneRichiesta').value;
                const ruolo = document.getElementById('ruolo').value;
                
                // Calcolo punteggi
                const punteggioTitoloStudio = parseFloat(document.getElementById('titoloStudio').value) || 0;
                const punteggioDottorato = parseFloat(document.getElementById('dottorato').value) || 0;
                const numMasterII = parseInt(document.getElementById('masterII').value) || 0;
                const punteggioMasterII = numMasterII * 0.50;
                const numMasterI = parseInt(document.getElementById('masterI').value) || 0;
                const punteggioMasterI = numMasterI * 0.30;
                
                // Punteggio titoli di studio totale
                const punteggioTitoli = punteggioTitoloStudio + punteggioDottorato + punteggioMasterII + punteggioMasterI;
                
                // Punteggio esperienza
                const anniEsperienza = parseInt(document.getElementById('anniEsperienza').value) || 0;
                const punteggioEsperienza = Math.min(anniEsperienza * 0.20, 2.00);
                
                // Punteggio servizio non incompatibile
                const punteggioServizioNonIncompatibile = parseFloat(document.getElementById('servizioNonIncompatibile').value) || 0;
                
                // Punteggio attestati corsi
                const numeroAttestati = parseInt(document.getElementById('attestatiCorsi').value) || 0;
                const punteggioAttestati = Math.min(numeroAttestati * 0.05, 0.25);
                
                // Punteggio giudizi
                const giudizioAnno1 = parseFloat(document.getElementById('giudizioAnno1').value) || 0;
                const giudizioAnno2 = parseFloat(document.getElementById('giudizioAnno2').value) || 0;
                const giudizioAnno3 = parseFloat(document.getElementById('giudizioAnno3').value) || 0;
                const mediaGiudizi = (giudizioAnno1 + giudizioAnno2 + giudizioAnno3) / 3;
                
                // Punteggio anzianità
                const anniServizio = Math.floor((dataInterpello - dataAssunzione) / (365.25 * 24 * 60 * 60 * 1000));
                const punteggioAnzianita = anniServizio * 0.30;
                
                // Punteggio patenti (solo per Nuclei Traduzioni)
                const punteggioPatenteA = document.getElementById('patenteA').checked ? 0.25 : 0;
                const punteggioPatenteB = document.getElementById('patenteB').checked ? 1.00 : 0;
                const punteggioPatenteC = document.getElementById('patenteC').checked ? 1.50 : 0;
                const punteggioPatenteD = document.getElementById('patenteD').checked ? 2.00 : 0;
                const punteggioPatenteE = document.getElementById('patenteE').checked ? 0.25 : 0;
                
                // Calcolo punteggio patenti non cumulabili
                let punteggioPatenti = 0;
                
                // Verifica se ha almeno una patente tra B, C o D
                const hasPatenteBase = punteggioPatenteB > 0 || punteggioPatenteC > 0 || punteggioPatenteD > 0;
                
                if (hasPatenteBase) {
                    // Prende solo il valore massimo tra le patenti B, C e D (non cumulabili)
                    const punteggioPatenteBase = Math.max(punteggioPatenteB, punteggioPatenteC, punteggioPatenteD);
                    
                    // Le patenti A ed E sono accessorie e sempre cumulabili con B, C o D
                    punteggioPatenti = punteggioPatenteBase + punteggioPatenteA + punteggioPatenteE;
                } else {
                    // Se non ha B, C o D, non può avere A o E
                    punteggioPatenti = 0;
                }
                
                // Punteggio colloquio (non presente nel form di inserimento, solo in modifica)
                const punteggioColloquio = 0;
                
                // Punteggio totale
                const punteggioTotale = punteggioTitoli + punteggioEsperienza + punteggioServizioNonIncompatibile + 
                                      punteggioAttestati + mediaGiudizi + punteggioAnzianita + punteggioPatenti + punteggioColloquio;
                
                // Creazione oggetto candidato
                const candidate = {
                    id: Date.now(), // ID unico basato sul timestamp
                    matricola,
                    nominativo,
                    dataAssunzione: dataAssunzione.toISOString(),
                    ruoloAnzianita,
                    istitutoAppartenenza,
                    dataNascita: dataNascita.toISOString(),
                    dataInterpello: dataInterpello.toISOString(),
                    destinazioneRichiesta, // Aggiungiamo la destinazione richiesta
                    ruolo, // Aggiungiamo il ruolo
                    punteggioTitoli,
                    punteggioEsperienza,
                    punteggioGiudizi: mediaGiudizi,
                    punteggioAnzianita,
                    punteggioPatenti,
                    punteggioColloquio,
                    punteggioTotale,
                    // Dettagli per la visualizzazione
                    titoloStudio: document.getElementById('titoloStudio').options[document.getElementById('titoloStudio').selectedIndex].text,
                    dottorato: document.getElementById('dottorato').value === "1.00" ? "Sì" : "No",
                    numMasterII: numMasterII,
                    numMasterI: numMasterI,
                    anniEsperienza,
                    servizioNonIncompatibile: document.getElementById('servizioNonIncompatibile').options[document.getElementById('servizioNonIncompatibile').selectedIndex].text,
                    attestatiCorsi: numeroAttestati,
                    giudizioAnno1: document.getElementById('giudizioAnno1').options[document.getElementById('giudizioAnno1').selectedIndex].text,
                    giudizioAnno2: document.getElementById('giudizioAnno2').options[document.getElementById('giudizioAnno2').selectedIndex].text,
                    giudizioAnno3: document.getElementById('giudizioAnno3').options[document.getElementById('giudizioAnno3').selectedIndex].text,
                    patenteA: document.getElementById('patenteA').checked ? "Sì" : "No",
                    patenteB: document.getElementById('patenteB').checked ? "Sì" : "No",
                    patenteC: document.getElementById('patenteC').checked ? "Sì" : "No",
                    patenteD: document.getElementById('patenteD').checked ? "Sì" : "No",
                    patenteE: document.getElementById('patenteE').checked ? "Sì" : "No"
                };
                
                // Aggiunta del candidato all'array
                candidates.push(candidate);
                
                // Salvataggio dell'array nel localStorage
                localStorage.setItem('candidates', JSON.stringify(candidates));
                
                // Aggiornamento della tabella
                updateTable();
                
                // Aggiorna anche la graduatoria finale se necessario
                updateGraduatoriaFinale();
                
                // Reset del form (tranne la data dell'interpello se bloccata e la destinazione se bloccata)
                if (!isInterpelloDateLocked) {
                    document.getElementById('dataInterpello').value = '';
                }
                if (!isDestinazioneRichiestaLocked) {
                    document.getElementById('destinazioneRichiesta').value = '';
                }
                document.getElementById('matricola').value = '';
                document.getElementById('nominativo').value = '';
                document.getElementById('dataAssunzione').value = '';
                document.getElementById('ruoloAnzianita').value = '';
                document.getElementById('istitutoAppartenenza').value = '';
                document.getElementById('dataNascita').value = '';
                document.getElementById('ruolo').value = '';
                document.getElementById('titoloStudio').value = '';
                document.getElementById('dottorato').value = '0';
                document.getElementById('masterII').value = '0';
                document.getElementById('masterI').value = '0';
                document.getElementById('anniEsperienza').value = '0';
                document.getElementById('servizioNonIncompatibile').value = '0';
                document.getElementById('attestatiCorsi').value = '0';
                document.getElementById('giudizioAnno1').value = '0';
                document.getElementById('giudizioAnno2').value = '0';
                document.getElementById('giudizioAnno3').value = '0';
                document.getElementById('patenteA').checked = false;
                document.getElementById('patenteB').checked = false;
                document.getElementById('patenteC').checked = false;
                document.getElementById('patenteD').checked = false;
                document.getElementById('patenteE').checked = false;
                
                // Messaggio di conferma
                alert('Candidato aggiunto con successo!');
                
                // Cambio tab alla graduatoria
                document.querySelector('[data-tab="tab-graduatoria"]').click();
            });

            // Reset form
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (!isInterpelloDateLocked) {
                    document.getElementById('dataInterpello').value = '';
                }
                if (!isDestinazioneRichiestaLocked) {
                    document.getElementById('destinazioneRichiesta').value = '';
                }
                document.getElementById('matricola').value = '';
                document.getElementById('nominativo').value = '';
                document.getElementById('dataAssunzione').value = '';
                document.getElementById('ruoloAnzianita').value = '';
                document.getElementById('istitutoAppartenenza').value = '';
                document.getElementById('dataNascita').value = '';
                document.getElementById('ruolo').value = '';
                document.getElementById('titoloStudio').value = '';
                document.getElementById('dottorato').value = '0';
                document.getElementById('masterII').value = '0';
                document.getElementById('masterI').value = '0';
                document.getElementById('anniEsperienza').value = '0';
                document.getElementById('servizioNonIncompatibile').value = '0';
                document.getElementById('attestatiCorsi').value = '0';
                document.getElementById('giudizioAnno1').value = '0';
                document.getElementById('giudizioAnno2').value = '0';
                document.getElementById('giudizioAnno3').value = '0';
                document.getElementById('patenteA').checked = false;
                document.getElementById('patenteB').checked = false;
                document.getElementById('patenteC').checked = false;
                document.getElementById('patenteD').checked = false;
                document.getElementById('patenteE').checked = false;
                if (document.getElementById('punteggioColloquio')) {
                    document.getElementById('punteggioColloquio').value = '';
                }
            });
            candidateForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Raccolta dati form
                const matricola = document.getElementById('matricola').value;
                const nominativo = document.getElementById('nominativo').value;
                const dataAssunzione = new Date(document.getElementById('dataAssunzione').value);
                const ruoloAnzianita = parseInt(document.getElementById('ruoloAnzianita').value);
                const istitutoAppartenenza = document.getElementById('istitutoAppartenenza').value;
                const dataNascita = new Date(document.getElementById('dataNascita').value);
                const dataInterpello = new Date(document.getElementById('dataInterpello').value);
                const destinazioneRichiesta = document.getElementById('destinazioneRichiesta').value;
                const ruolo = document.getElementById('ruolo').value;
                
                // Calcolo punteggi
                const punteggioTitoloStudio = parseFloat(document.getElementById('titoloStudio').value) || 0;
                const punteggioDottorato = parseFloat(document.getElementById('dottorato').value) || 0;
                const numMasterII = parseInt(document.getElementById('masterII').value) || 0;
                const punteggioMasterII = numMasterII * 0.50;
                const numMasterI = parseInt(document.getElementById('masterI').value) || 0;
                const punteggioMasterI = numMasterI * 0.30;

                // Punteggio titoli di studio totale
                const punteggioTitoli = punteggioTitoloStudio + punteggioDottorato + punteggioMasterII + punteggioMasterI;
                
                // Punteggio esperienza
                const anniEsperienza = parseInt(document.getElementById('anniEsperienza').value) || 0;
                const punteggioEsperienza = Math.min(anniEsperienza * 0.20, 2.00);
                
                // Punteggio servizio non incompatibile
                const punteggioServizioNonIncompatibile = parseFloat(document.getElementById('servizioNonIncompatibile').value) || 0;
                
                // Punteggio attestati corsi
                const numeroAttestati = parseInt(document.getElementById('attestatiCorsi').value) || 0;
                const punteggioAttestati = Math.min(numeroAttestati * 0.05, 0.25);
                
                // Punteggio giudizi
                const giudizioAnno1 = parseFloat(document.getElementById('giudizioAnno1').value) || 0;
                const giudizioAnno2 = parseFloat(document.getElementById('giudizioAnno2').value) || 0;
                const giudizioAnno3 = parseFloat(document.getElementById('giudizioAnno3').value) || 0;
                const mediaGiudizi = (giudizioAnno1 + giudizioAnno2 + giudizioAnno3) / 3;
                
                // Punteggio anzianità
                const anniServizio = Math.floor((dataInterpello - dataAssunzione) / (365.25 * 24 * 60 * 60 * 1000));
                const punteggioAnzianita = anniServizio * 0.30;
                
                // Punteggio patenti (solo per Nuclei Traduzioni)
                const punteggioPatenteA = document.getElementById('patenteA').checked ? 0.25 : 0;
                const punteggioPatenteB = document.getElementById('patenteB').checked ? 1.00 : 0;
                const punteggioPatenteC = document.getElementById('patenteC').checked ? 1.50 : 0;
                const punteggioPatenteD = document.getElementById('patenteD').checked ? 2.00 : 0;
                const punteggioPatenteE = document.getElementById('patenteE').checked ? 0.25 : 0;
                
                // Calcolo punteggio patenti non cumulabili
                let punteggioPatenti = 0;
                
                // Verifica se ha almeno una patente tra B, C o D
                const hasPatenteBase = punteggioPatenteB > 0 || punteggioPatenteC > 0 || punteggioPatenteD > 0;
                
                if (hasPatenteBase) {
                    // Prende solo il valore massimo tra le patenti B, C e D (non cumulabili)
                    const punteggioPatenteBase = Math.max(punteggioPatenteB, punteggioPatenteC, punteggioPatenteD);
                    
                    // Le patenti A ed E sono accessorie e sempre cumulabili con B, C o D
                    punteggioPatenti = punteggioPatenteBase + punteggioPatenteA + punteggioPatenteE;
                } else {
                    // Se non ha B, C o D, non può avere A o E
                    punteggioPatenti = 0;
                }
                
                // Punteggio colloquio (facoltativo)
                const punteggioColloquio = parseFloat(document.getElementById('punteggioColloquio').value) || 0;
                
                // Punteggio totale
                const punteggioTotale = punteggioTitoli + punteggioEsperienza + punteggioServizioNonIncompatibile + 
                                      punteggioAttestati + mediaGiudizi + punteggioAnzianita + punteggioPatenti + punteggioColloquio;
                
                // Creazione oggetto candidato
                const candidate = {
                    id: Date.now(), // ID unico basato sul timestamp
                    matricola,
                    nominativo,
                    dataAssunzione: dataAssunzione.toISOString(),
                    ruoloAnzianita,
                    istitutoAppartenenza,
                    dataNascita: dataNascita.toISOString(),
                    dataInterpello: dataInterpello.toISOString(),
                    destinazioneRichiesta, // Aggiungiamo la destinazione richiesta
                    ruolo, // Aggiungiamo il ruolo
                    punteggioTitoli,
                    punteggioEsperienza,
                    punteggioGiudizi: mediaGiudizi,
                    punteggioAnzianita,
                    punteggioPatenti,
                    punteggioColloquio,
                    punteggioTotale,
                    // Dettagli per la visualizzazione
                    titoloStudio: document.getElementById('titoloStudio').options[document.getElementById('titoloStudio').selectedIndex].text,
                    dottorato: document.getElementById('dottorato').value === "1.00" ? "Sì" : "No",
                    numMasterII: numMasterII,
                    numMasterI: numMasterI,
                    anniEsperienza,
                    servizioNonIncompatibile: document.getElementById('servizioNonIncompatibile').options[document.getElementById('servizioNonIncompatibile').selectedIndex].text,
                    attestatiCorsi: numeroAttestati,
                    giudizioAnno1: document.getElementById('giudizioAnno1').options[document.getElementById('giudizioAnno1').selectedIndex].text,
                    giudizioAnno2: document.getElementById('giudizioAnno2').options[document.getElementById('giudizioAnno2').selectedIndex].text,
                    giudizioAnno3: document.getElementById('giudizioAnno3').options[document.getElementById('giudizioAnno3').selectedIndex].text,
                    patenteA: document.getElementById('patenteA').checked ? "Sì" : "No",
                    patenteB: document.getElementById('patenteB').checked ? "Sì" : "No",
                    patenteC: document.getElementById('patenteC').checked ? "Sì" : "No",
                    patenteD: document.getElementById('patenteD').checked ? "Sì" : "No",
                    patenteE: document.getElementById('patenteE').checked ? "Sì" : "No"
                };
                
                // Aggiunta del candidato all'array
                candidates.push(candidate);
                
                // Salvataggio dell'array nel localStorage
                localStorage.setItem('candidates', JSON.stringify(candidates));
                
                // Aggiornamento della tabella
                updateTable();
                
                // Aggiorna anche la graduatoria finale se necessario
                updateGraduatoriaFinale();
                
                // Reset del form (tranne la data dell'interpello se bloccata e la destinazione se bloccata)
                if (!isInterpelloDateLocked) {
                    document.getElementById('dataInterpello').value = '';
                }
                if (!isDestinazioneRichiestaLocked) {
                    document.getElementById('destinazioneRichiesta').value = '';
                }
                document.getElementById('matricola').value = '';
                document.getElementById('nominativo').value = '';
                document.getElementById('dataAssunzione').value = '';
                document.getElementById('ruoloAnzianita').value = '';
                document.getElementById('istitutoAppartenenza').value = '';
                document.getElementById('dataNascita').value = '';
                document.getElementById('ruolo').value = '';
                document.getElementById('titoloStudio').value = '';
                document.getElementById('dottorato').value = '0';
                document.getElementById('masterII').value = '0';
                document.getElementById('masterI').value = '0';
                document.getElementById('anniEsperienza').value = '0';
                document.getElementById('servizioNonIncompatibile').value = '0';
                document.getElementById('attestatiCorsi').value = '0';
                document.getElementById('giudizioAnno1').value = '0';
                document.getElementById('giudizioAnno2').value = '0';
                document.getElementById('giudizioAnno3').value = '0';
                document.getElementById('patenteA').checked = false;
                document.getElementById('patenteB').checked = false;
                document.getElementById('patenteC').checked = false;
                document.getElementById('patenteD').checked = false;
                document.getElementById('patenteE').checked = false;
                document.getElementById('punteggioColloquio').value = '';
                
                // Messaggio di conferma
                alert('Candidato aggiunto con successo!');
                
                // Cambio tab alla graduatoria
                document.querySelector('[data-tab="tab-graduatoria"]').click();
            });

            // Reset form
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (!isInterpelloDateLocked) {
                    document.getElementById('dataInterpello').value = '';
                }
                if (!isDestinazioneRichiestaLocked) {
                    document.getElementById('destinazioneRichiesta').value = '';
                }
                document.getElementById('matricola').value = '';
                document.getElementById('nominativo').value = '';
                document.getElementById('dataAssunzione').value = '';
                document.getElementById('ruoloAnzianita').value = '';
                document.getElementById('istitutoAppartenenza').value = '';
                document.getElementById('dataNascita').value = '';
                document.getElementById('ruolo').value = '';
                document.getElementById('titoloStudio').value = '';
                document.getElementById('dottorato').value = '0';
                document.getElementById('masterII').value = '0';
                document.getElementById('masterI').value = '0';
                document.getElementById('anniEsperienza').value = '0';
                document.getElementById('servizioNonIncompatibile').value = '0';
                document.getElementById('attestatiCorsi').value = '0';
                document.getElementById('giudizioAnno1').value = '0';
                document.getElementById('giudizioAnno2').value = '0';
                document.getElementById('giudizioAnno3').value = '0';
                document.getElementById('patenteA').checked = false;
                document.getElementById('patenteB').checked = false;
                document.getElementById('patenteC').checked = false;
                document.getElementById('patenteD').checked = false;
                document.getElementById('patenteE').checked = false;
                document.getElementById('punteggioColloquio').value = '';
            });

            // Esporta graduatoria in PDF
            document.getElementById('exportPdfBtn').addEventListener('click', function() {
                if (candidates.length === 0) {
                    alert('Nessun candidato da esportare');
                    return;
                }

                // Trova la destinazione richiesta
                const destinazione = candidates.length > 0 && candidates[0].destinazioneRichiesta ? 
                                   candidates[0].destinazioneRichiesta : 'Interpello';
                
                // Ordina i candidati come nella tabella principale
                const sortedCandidates = [...candidates].sort((a, b) => {
                    if (b.punteggioTotale !== a.punteggioTotale) {
                        return b.punteggioTotale - a.punteggioTotale;
                    }
                    if (a.ruoloAnzianita !== b.ruoloAnzianita) {
                        return a.ruoloAnzianita - b.ruoloAnzianita;
                    }
                    if (b.punteggioAnzianita !== a.punteggioAnzianita) {
                        return b.punteggioAnzianita - a.punteggioAnzianita;
                    }
                    return new Date(b.dataNascita) - new Date(a.dataNascita);
                });

                // Genera HTML completo per PDF - Formato A3 Orizzontale per Affissione
                let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Graduatoria per ${destinazione}</title>
                    <style>
                        * {
                            margin: 0 !important;
                            padding: 0 !important;
                            border-radius: 0 !important;
                            box-shadow: none !important;
                            background: white !important;
                            color: black !important;
                        }
                        body {
                            font-family: 'Arial Black', 'Arial', sans-serif !important;
                            font-size: 12px !important;
                            background: white !important;
                            margin: 0 !important;
                            padding: 5mm !important;
                            font-weight: bold !important;
                        }
                        .title {
                            text-align: center !important;
                            font-size: 28px !important;
                            font-weight: 900 !important;
                            margin-bottom: 8mm !important;
                            color: black !important;
                            text-transform: uppercase !important;
                            letter-spacing: 2px !important;
                            border: 3px solid black !important;
                            padding: 10px !important;
                            background: #f8f8f8 !important;
                        }
                        table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            font-size: 11px !important;
                            border: 3px solid black !important;
                            background: white !important;
                            font-weight: bold !important;
                        }
                        th {
                            border: 2px solid black !important;
                            padding: 8px !important;
                            text-align: center !important;
                            font-weight: 900 !important;
                            background: #e0e0e0 !important;
                            color: black !important;
                            font-size: 12px !important;
                            height: 25px !important;
                            text-transform: uppercase !important;
                            letter-spacing: 1px !important;
                        }
                        td {
                            border: 1.5px solid black !important;
                            padding: 6px !important;
                            font-size: 11px !important;
                            background: white !important;
                            color: black !important;
                            height: 20px !important;
                            font-weight: bold !important;
                            vertical-align: middle !important;
                        }
                        .pos { 
                            width: 5% !important; 
                            text-align: center !important;
                            font-size: 20px !important;
                            font-weight: 900 !important;
                            background: white !important;
                            color: black !important;
                        }
                        .mat { width: 8% !important; text-align: center !important; }
                        .nome { 
                            width: 16% !important; 
                            text-align: left !important;
                            font-size: 13px !important;
                        }
                        .ruolo { width: 10% !important; text-align: left !important; }
                        .dest { width: 13% !important; text-align: left !important; }
                        .tit { width: 6% !important; text-align: center !important; }
                        .esp { width: 8% !important; text-align: center !important; }
                        .cau { width: 7% !important; text-align: center !important; }
                        .att { width: 7% !important; text-align: center !important; }
                        .giu { width: 6% !important; text-align: center !important; }
                        .anz { width: 6% !important; text-align: center !important; }
                        .pat { width: 5% !important; text-align: center !important; }
                        .tot { 
                            width: 8% !important; 
                            text-align: center !important;
                            font-size: 18px !important;
                            font-weight: 900 !important;
                            background: #f0f0f0 !important;
                        }
                        
                        tr:nth-child(even) { background: #f8f8f8 !important; }
                        tr:nth-child(odd) { background: white !important; }
                        
                        /* Tutte le righe con stesso peso del carattere */
                        tbody tr td { font-weight: 900 !important; }
                        
                        @page {
                            size: A3 landscape !important;
                            margin: 10mm !important;
                        }
                        @media print {
                            body { 
                                -webkit-print-color-adjust: exact !important;
                                color-adjust: exact !important;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="title">Graduatoria per ${destinazione}</div>
                    <table>
                        <thead>
                            <tr>
                                <th class="pos">Pos.</th>
                                <th class="mat">Matricola</th>
                                <th class="nome">Nominativo</th>
                                <th class="ruolo">Ruolo</th>
                                <th class="dest">Istituto</th>
                                <th class="tit">Titoli</th>
                                <th class="esp">Esperienza</th>
                                <th class="cau">Cause S.</th>
                                <th class="att">Attestati</th>
                                <th class="giu">Giudizi</th>
                                <th class="anz">Anzianità</th>
                                <th class="pat">Pat.</th>
                                <th class="tot">Totale</th>
                            </tr>
                        </thead>
                        <tbody>`;

                // Aggiungi ogni candidato con formato uniforme
                sortedCandidates.forEach((candidate, index) => {
                    // Calcola punteggi individuali
                    const punteggioCauseServizio = candidate.servizioNonIncompatibile.includes("Minimo") ? 0.25 : 
                                                  candidate.servizioNonIncompatibile.includes("Medio") ? 0.50 :
                                                  candidate.servizioNonIncompatibile.includes("Massimo") ? 0.75 : 0;
                    
                    const punteggioAttestati = candidate.attestatiCorsi * 0.05;

                    htmlContent += `
                        <tr>
                            <td class="pos">${index + 1}</td>
                            <td class="mat">${candidate.matricola}</td>
                            <td class="nome">${candidate.nominativo}</td>
                            <td class="ruolo">${candidate.ruolo || ''}</td>
                            <td class="dest">${candidate.istitutoAppartenenza || ''}</td>
                            <td class="tit">${candidate.punteggioTitoli.toFixed(2)}</td>
                            <td class="esp">${candidate.punteggioEsperienza.toFixed(2)}</td>
                            <td class="cau">${punteggioCauseServizio.toFixed(2)}</td>
                            <td class="att">${punteggioAttestati.toFixed(2)}</td>
                            <td class="giu">${candidate.punteggioGiudizi.toFixed(2)}</td>
                            <td class="anz">${candidate.punteggioAnzianita.toFixed(2)}</td>
                            <td class="pat">${candidate.punteggioPatenti.toFixed(2)}</td>
                            <td class="tot">${candidate.punteggioTotale.toFixed(2)}</td>
                        </tr>`;
                });

                htmlContent += `
                        </tbody>
                    </table>
                </body>
                </html>`;

                // Crea il blob HTML
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                // Crea nome file sicuro
                const fileName = `Graduatoria_${destinazione.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
                
                // Crea link per download
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = fileName;
                downloadLink.style.display = 'none';
                
                // Aggiungi al DOM, clicca e rimuovi
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                // Libera la memoria
                URL.revokeObjectURL(url);
                
                // Messaggio informativo per formato A3
                alert(`File HTML scaricato: "${fileName}"\n\nPer convertire in PDF:\n1. Apri il file scaricato nel browser\n2. Premi Ctrl+P (o Cmd+P su Mac)\n3. Seleziona "Salva come PDF"\n4. Assicurati che sia selezionato formato A3 Orizzontale\n5. Clicca "Salva"\n\nIl file è ottimizzato per l'affissione con caratteri grandi e chiari.`);
            });

            // Nuovo inserimento
            document.getElementById('newCandidateBtn').addEventListener('click', function() {
                document.querySelector('[data-tab="tab-inserimento"]').click();
            });

            // Reset graduatoria
            document.getElementById('resetGraduatoriaBtn').addEventListener('click', function() {
                if (confirm('Sei sicuro di voler resettare l\'intera graduatoria? Tutti i dati verranno eliminati.')) {
                    candidates = [];
                    localStorage.setItem('candidates', JSON.stringify(candidates));
                    updateTable();
                    updateGraduatoriaFinale();
                }
            });

             // Esporta in Excel
            document.getElementById('exportExcelBtn').addEventListener('click', function() {
                if (candidates.length === 0) {
                    alert('Nessun candidato da esportare');
                    return;
                }

                // Ordina i candidati come nella tabella
                const sortedCandidates = [...candidates].sort((a, b) => {
                    if (b.punteggioTotale !== a.punteggioTotale) {
                        return b.punteggioTotale - a.punteggioTotale;
                    }
                    if (a.ruoloAnzianita !== b.ruoloAnzianita) {
                        return a.ruoloAnzianita - b.ruoloAnzianita;
                    }
                    if (b.punteggioAnzianita !== a.punteggioAnzianita) {
                        return b.punteggioAnzianita - a.punteggioAnzianita;
                    }
                    return new Date(b.dataNascita) - new Date(a.dataNascita);
                });

                // Crea il contenuto CSV con separatore di elenco per i campi multipli
                let csvContent = "Posizione;Matricola;Nominativo;Ruolo;Destinazione Richiesta;Data Assunzione;Ruolo Anzianità;Istituto Appartenenza;Data Nascita;Data Interpello;";
                csvContent += "Titolo Studio;Dottorato;Numero Master II Livello;Numero Master I Livello;Punteggio Titoli;";
                csvContent += "Anni Esperienza;Punteggio Esperienza;Causa Servizio Non Incompatibile;Punteggio Cause Servizio;";
                csvContent += "Numero Attestati;Punteggio Attestati;Giudizio Anno 1;Giudizio Anno 2;Giudizio Anno 3;Media Giudizi;";
                csvContent += "Anni Servizio;Punteggio Anzianità;Patente A;Patente B;Patente C;Patente D;Patente E;Punteggio Patenti;";
                csvContent += "Punteggio Colloquio;Punteggio Totale\n";

                sortedCandidates.forEach((candidate, index) => {
                    const posizione = index + 1;
                    const dataAssunzione = new Date(candidate.dataAssunzione).toLocaleDateString('it-IT');
                    const dataNascita = new Date(candidate.dataNascita).toLocaleDateString('it-IT');
                    const dataInterpello = new Date(candidate.dataInterpello).toLocaleDateString('it-IT');
                    const anniServizio = Math.round(candidate.punteggioAnzianita / 0.30);
                    
                    const numMasterII_display = candidate.numMasterII !== undefined ? candidate.numMasterII : (candidate.masterII === "Sì" ? 1 : 0);
                    const numMasterI_display = candidate.numMasterI !== undefined ? candidate.numMasterI : (candidate.masterI === "Sì" ? 1 : 0);

                    // Calcola il punteggio delle cause di servizio
                    const punteggioCauseServizio = candidate.servizioNonIncompatibile.includes("Minimo") ? 0.25 : 
                                                  candidate.servizioNonIncompatibile.includes("Medio") ? 0.50 :
                                                  candidate.servizioNonIncompatibile.includes("Massimo") ? 0.75 : 0;

                    // Funzione per formattare i valori con separatore di elenco
                    const formatValue = (value) => {
                        if (Array.isArray(value)) {
                            return `"${value.join(', ')}"`;
                        }
                        return `"${value}"`;
                    };

                    csvContent += `${posizione};${formatValue(candidate.matricola)};${formatValue(candidate.nominativo)};${formatValue(candidate.ruolo)};${formatValue(candidate.destinazioneRichiesta)};`;
                    csvContent += `${dataAssunzione};${candidate.ruoloAnzianita};${formatValue(candidate.istitutoAppartenenza)};${dataNascita};${dataInterpello};`;
                    csvContent += `${formatValue(candidate.titoloStudio)};${formatValue(candidate.dottorato)};${numMasterII_display};${numMasterI_display};${candidate.punteggioTitoli.toFixed(2).replace('.', ',')};`;
                    csvContent += `${candidate.anniEsperienza};${candidate.punteggioEsperienza.toFixed(2).replace('.', ',')};${formatValue(candidate.servizioNonIncompatibile)};${punteggioCauseServizio.toFixed(2).replace('.', ',')};`;
                    csvContent += `${candidate.attestatiCorsi};${(candidate.attestatiCorsi * 0.05).toFixed(2).replace('.', ',')};`;
                    csvContent += `${formatValue(candidate.giudizioAnno1)};${formatValue(candidate.giudizioAnno2)};${formatValue(candidate.giudizioAnno3)};${candidate.punteggioGiudizi.toFixed(2).replace('.', ',')};`;
                    csvContent += `${anniServizio};${candidate.punteggioAnzianita.toFixed(2).replace('.', ',')};`;
                    csvContent += `${formatValue(candidate.patenteA)};${formatValue(candidate.patenteB)};${formatValue(candidate.patenteC)};${formatValue(candidate.patenteD)};${formatValue(candidate.patenteE)};${candidate.punteggioPatenti.toFixed(2).replace('.', ',')};`;
                    csvContent += `${(candidate.punteggioColloquio || 0).toFixed(2).replace('.', ',')};${candidate.punteggioTotale.toFixed(2).replace('.', ',')}\n`;
                });

                // Crea il blob e il link per il download
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `graduatoria_interpello_${new Date(candidates[0].dataInterpello).toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            
            // Esporta in JSON
            document.getElementById('exportJsonBtn').addEventListener('click', function() {
                if (candidates.length === 0) {
                    alert('Nessun candidato da esportare');
                    return;
                }

                // Crea il contenuto JSON
                const dataToExport = {
                    candidates: candidates,
                    isInterpelloDateLocked: isInterpelloDateLocked,
                    lockedInterpelloDate: lockedInterpelloDate,
                    isDestinazioneRichiestaLocked: isDestinazioneRichiestaLocked,
                    lockedDestinazioneRichiesta: lockedDestinazioneRichiesta
                };

                const jsonContent = JSON.stringify(dataToExport, null, 2);
                
                // Crea il blob e il link per il download
                const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `graduatoria_interpello_${new Date(candidates[0].dataInterpello).toISOString().split('T')[0]}.json`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // Importa da JSON
            document.getElementById('importJsonInput').addEventListener('change', function(event) {
                const files = event.target.files;
                if (!files || files.length === 0) return;

                // Array per raccogliere tutti i candidati da tutti i file
                let allCandidates = [];
                let filesProcessed = 0;
                let totalFiles = files.length;
                
                // Variabili per le impostazioni di blocco (manterremo quelle correnti se non specificate)
                let importedInterpelloSettings = null;
                let importedDestinazioneSettings = null;

                // Conferma dell'operazione
                let mergeMode = false;
                if (candidates.length > 0) {
                    const result = confirm(`Hai già ${candidates.length} candidati nella graduatoria.\n\nClicca OK per UNIRE i nuovi candidati a quelli esistenti.\nClicca ANNULLA per SOSTITUIRE completamente la graduatoria attuale.`);
                    mergeMode = result;
                    
                    if (!result && !confirm(`Sei sicuro di voler SOSTITUIRE l'intera graduatoria? Tutti i dati attuali verranno eliminati.`)) {
                        event.target.value = '';
                        return;
                    }
                } else if (!confirm(`Stai per importare ${totalFiles} file${totalFiles > 1 ? 's' : ''}. Vuoi procedere?`)) {
                    event.target.value = '';
                    return;
                }

                // Funzione per processare ogni file
                const processFile = (file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (!importedData.candidates || !Array.isArray(importedData.candidates)) {
                                throw new Error(`Formato non valido nel file ${file.name}`);
                            }

                            // Aggiungi i candidati all'array totale
                            allCandidates = allCandidates.concat(importedData.candidates);
                            
                            // Salva le impostazioni di blocco dal primo file che le contiene
                            if (importedData.isInterpelloDateLocked !== undefined && importedInterpelloSettings === null) {
                                importedInterpelloSettings = {
                                    isLocked: importedData.isInterpelloDateLocked,
                                    date: importedData.lockedInterpelloDate
                                };
                            }
                            
                            if (importedData.isDestinazioneRichiestaLocked !== undefined && importedDestinazioneSettings === null) {
                                importedDestinazioneSettings = {
                                    isLocked: importedData.isDestinazioneRichiestaLocked,
                                    destinazione: importedData.lockedDestinazioneRichiesta
                                };
                            }

                            filesProcessed++;
                            
                            // Se abbiamo processato tutti i file
                            if (filesProcessed === totalFiles) {
                                finalizeImport();
                            }
                        } catch (error) {
                            console.error(`Errore nel file ${file.name}:`, error);
                            alert(`Errore durante l'importazione del file ${file.name}: ${error.message}`);
                            filesProcessed++;
                            
                            // Continua con gli altri file anche se uno fallisce
                            if (filesProcessed === totalFiles) {
                                finalizeImport();
                            }
                        }
                    };
                    reader.readAsText(file);
                };

                // Funzione per finalizzare l'importazione
                const finalizeImport = () => {
                    if (allCandidates.length === 0) {
                        alert('Nessun candidato valido trovato nei file importati.');
                        event.target.value = '';
                        return;
                    }

                    // Se siamo in modalità merge, aggiungi i candidati esistenti
                    if (mergeMode) {
                        allCandidates = candidates.concat(allCandidates);
                    }

                    // Rimuovi duplicati basandosi sulla matricola
                    const uniqueCandidates = [];
                    const matricoleViste = new Set();
                    const candidatiDuplicatiDettagli = [];
                    
                    for (const candidate of allCandidates) {
                        if (!matricoleViste.has(candidate.matricola)) {
                            matricoleViste.add(candidate.matricola);
                            uniqueCandidates.push(candidate);
                        } else {
                            candidatiDuplicatiDettagli.push(candidate.matricola + ' - ' + candidate.nominativo);
                        }
                    }

                    // Assegna nuovi ID univoci ai candidati per evitare conflitti
                    uniqueCandidates.forEach((candidate, index) => {
                        candidate.id = Date.now() + index;
                    });

                    // Aggiorna i candidati
                    candidates = uniqueCandidates;
                    localStorage.setItem('candidates', JSON.stringify(candidates));
                    
                    // Applica le impostazioni di blocco se presenti e non siamo in merge mode
                    if (!mergeMode && importedInterpelloSettings) {
                        isInterpelloDateLocked = importedInterpelloSettings.isLocked;
                        lockedInterpelloDate = importedInterpelloSettings.date || '';
                        localStorage.setItem('isInterpelloDateLocked', isInterpelloDateLocked.toString());
                        localStorage.setItem('lockedInterpelloDate', lockedInterpelloDate);
                        
                        // Aggiorna UI
                        const lockBtn = document.getElementById('lockInterpelloDate');
                        if (isInterpelloDateLocked) {
                            lockBtn.classList.add('locked');
                            document.getElementById('dataInterpello').value = lockedInterpelloDate;
                        } else {
                            lockBtn.classList.remove('locked');
                        }
                    }
                    
                    if (!mergeMode && importedDestinazioneSettings) {
                        isDestinazioneRichiestaLocked = importedDestinazioneSettings.isLocked;
                        lockedDestinazioneRichiesta = importedDestinazioneSettings.destinazione || '';
                        localStorage.setItem('isDestinazioneRichiestaLocked', isDestinazioneRichiestaLocked.toString());
                        localStorage.setItem('lockedDestinazioneRichiesta', lockedDestinazioneRichiesta);
                        
                        // Aggiorna UI
                        const lockDestinazioneBtn = document.getElementById('lockDestinazioneBtn');
                        if (isDestinazioneRichiestaLocked) {
                            lockDestinazioneBtn.classList.add('locked');
                            document.getElementById('destinazioneRichiesta').value = lockedDestinazioneRichiesta;
                        } else {
                            lockDestinazioneBtn.classList.remove('locked');
                        }
                    }
                    
                    // Aggiorna la tabella
                    updateTable();
                    updateGraduatoriaFinale();
                    
                    // Mostra riepilogo dettagliato
                    const candidatiDuplicati = candidatiDuplicatiDettagli.length;
                    let message = `Importazione completata!\n\n`;
                    message += `File processati: ${totalFiles}\n`;
                    message += `Modalità: ${mergeMode ? 'UNIONE con graduatoria esistente' : 'SOSTITUZIONE graduatoria'}\n`;
                    message += `Candidati totali trovati: ${allCandidates.length}\n`;
                    message += `Candidati unici nella graduatoria finale: ${uniqueCandidates.length}`;
                    
                    if (candidatiDuplicati > 0) {
                        message += `\n\nCandidati duplicati rimossi: ${candidatiDuplicati}`;
                        if (candidatiDuplicati <= 10) {
                            message += `\n${candidatiDuplicatiDettagli.join('\n')}`;
                        } else {
                            message += `\n(Primi 10: ${candidatiDuplicatiDettagli.slice(0, 10).join(', ')}...)`;
                        }
                    }
                    
                    alert(message);
                    
                    // Vai alla tab graduatoria
                    document.querySelector('[data-tab="tab-graduatoria"]').click();
                    
                    // Reset input
                    event.target.value = '';
                };

                // Processa tutti i file
                Array.from(files).forEach((file, index) => {
                    processFile(file, index);
                });
            });

            // Funzione per aggiornare la tabella della graduatoria
            function updateTable() {
                const tableBody = document.getElementById('candidateTableBody');
                const noDataAlert = document.getElementById('noDataAlert');
                const tableContainer = document.getElementById('tableContainer');
                
                // Svuota la tabella
                tableBody.innerHTML = '';
                
                if (candidates.length === 0) {
                    noDataAlert.style.display = 'block';
                    tableContainer.style.display = 'none';
                    return;
                }
                
                noDataAlert.style.display = 'none';
                tableContainer.style.display = 'block';
                
                // Ordina i candidati per punteggio totale (decrescente)
                candidates.sort((a, b) => {
                    // Ordine per punteggio totale
                    if (b.punteggioTotale !== a.punteggioTotale) {
                        return b.punteggioTotale - a.punteggioTotale;
                    }
                    
                    // In caso di parità, ordine per ruolo di anzianità (crescente - numero più piccolo primo)
                    if (a.ruoloAnzianita !== b.ruoloAnzianita) {
                        return a.ruoloAnzianita - b.ruoloAnzianita;
                    }
                    
                    // In caso di ulteriore parità, ordine per anzianità di servizio
                    if (b.punteggioAnzianita !== a.punteggioAnzianita) {
                        return b.punteggioAnzianita - a.punteggioAnzianita;
                    }
                    
                    // In caso di ulteriore parità, ordine per data di nascita (il più giovane)
                    return new Date(b.dataNascita) - new Date(a.dataNascita);
                });
                
                // Popola la tabella
                candidates.forEach((candidate, index) => {
                    const row = document.createElement('tr');
                    
                    // Classe per le prime posizioni
                    if (index < 3) {
                        row.classList.add(`top-${index + 1}`);
                    }
                    
                    // Prepara i dettagli dei titoli di studio (solo punteggio)
                    let titoliDettaglio = `${candidate.punteggioTitoli.toFixed(2)}`;
                    
                    // Prepara i dettagli dell'esperienza (solo anni)
                    let esperienzaDettaglio = `${candidate.anniEsperienza} anni<br><small class="text-muted">(${candidate.punteggioEsperienza.toFixed(2)} pt.)</small>`;
                    
                    // Prepara i dettagli delle cause di servizio
                    let causeDettaglio = candidate.servizioNonIncompatibile;
                    if (candidate.servizioNonIncompatibile !== "No") {
                        const punteggioCause = parseFloat(candidate.servizioNonIncompatibile.includes("0.25") ? "0.25" : 
                                                        candidate.servizioNonIncompatibile.includes("0.50") ? "0.50" :
                                                        candidate.servizioNonIncompatibile.includes("0.75") ? "0.75" : "0");
                        causeDettaglio += `<br><small class="text-muted">(${punteggioCause.toFixed(2)} pt.)</small>`;
                    } else {
                        causeDettaglio = "-";
                    }
                    
                    // Prepara i dettagli degli attestati
                    let attestatiDettaglio = candidate.attestatiCorsi > 0 ? 
                        `${candidate.attestatiCorsi} attestati<br><small class="text-muted">(${(candidate.attestatiCorsi * 0.05).toFixed(2)} pt.)</small>` : 
                        "-";
                    
                    // Prepara i dettagli dei giudizi (solo punteggio)
                    let giudiziDettaglio = `${candidate.punteggioGiudizi.toFixed(2)}`;
                    
                    // Prepara i dettagli delle patenti
                    const patenti = [];
                    if (candidate.patenteA === "Sì") patenti.push("A");
                    if (candidate.patenteB === "Sì") patenti.push("B");
                    if (candidate.patenteC === "Sì") patenti.push("C");
                    if (candidate.patenteD === "Sì") patenti.push("D");
                    if (candidate.patenteE === "Sì") patenti.push("E");
                    const patentiDettaglio = patenti.length > 0 ? patenti.join(", ") : "-";
                    
                    row.innerHTML = `
                        <td class="text-center">
                            <div class="rank ${index < 3 ? 'rank-' + (index + 1) : ''}">${index + 1}</div>
                        </td>
                        <td>${candidate.matricola}</td>
                        <td>${candidate.nominativo}</td>
                        <td>${candidate.ruolo || ''}</td>
                        <td>${candidate.istitutoAppartenenza || ''}</td>
                        <td class="text-center">${titoliDettaglio}</td>
                        <td style="min-width: 80px;">${esperienzaDettaglio}</td>
                        <td style="min-width: 100px;">${causeDettaglio}</td>
                        <td style="min-width: 80px;">${attestatiDettaglio}</td>
                        <td class="text-center">${giudiziDettaglio}</td>
                        <td>${candidate.punteggioAnzianita.toFixed(2)}</td>
                        <td style="min-width: 80px;">${patentiDettaglio}${patenti.length > 0 ? '<br><small class="text-muted">(' + candidate.punteggioPatenti.toFixed(2) + ' pt.)</small>' : ''}</td>
                        <td><strong>${candidate.punteggioTotale.toFixed(2)}</strong></td>
                        <td>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-sm btn-primary details-btn" data-id="${candidate.id}">Dettagli</button>
                                <button class="btn btn-sm btn-warning edit-btn" data-id="${candidate.id}">Modifica</button>
                                <button class="btn btn-sm btn-danger delete-btn" data-id="${candidate.id}">Elimina</button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Aggiunge event listener ai pulsanti elimina
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const candidateId = parseInt(this.getAttribute('data-id'));
                        removeCandidate(candidateId);
                    });
                });

                // Aggiunge event listener ai pulsanti dettagli
                document.querySelectorAll('.details-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const candidateId = parseInt(this.getAttribute('data-id'));
                        showCandidateDetails(candidateId);
                    });
                });

                // Aggiunge event listener ai pulsanti modifica
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const candidateId = parseInt(this.getAttribute('data-id'));
                        editCandidate(candidateId);
                    });
                });
            }

            // Funzione per rimuovere un candidato
            function removeCandidate(id) {
                if (confirm('Sei sicuro di voler eliminare questo candidato?')) {
                    candidates = candidates.filter(candidate => candidate.id !== id);
                    localStorage.setItem('candidates', JSON.stringify(candidates));
                    updateTable();
                    updateGraduatoriaFinale();
                }
            }

            // Funzione per mostrare i dettagli del candidato
            function showCandidateDetails(id) {
                const candidate = candidates.find(c => c.id === id);
                if (!candidate) return;

                // Gestione retrocompatibilità per i master
                const numMasterII_display = candidate.numMasterII !== undefined ? candidate.numMasterII : (candidate.masterII === "Sì" ? 1 : 0);
                const numMasterI_display = candidate.numMasterI !== undefined ? candidate.numMasterI : (candidate.masterI === "Sì" ? 1 : 0);

                const modalBody = document.getElementById('detailsModalBody');
                modalBody.innerHTML = `
                    <div class="detail-row">
                        <div class="detail-label">Matricola:</div>
                        <div class="detail-value">${candidate.matricola}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Nominativo:</div>
                        <div class="detail-value">${candidate.nominativo}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ruolo:</div>
                        <div class="detail-value">${candidate.ruolo || ''}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Destinazione Richiesta:</div>
                        <div class="detail-value">${candidate.destinazioneRichiesta || ''}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Data Assunzione:</div>
                        <div class="detail-value">${new Date(candidate.dataAssunzione).toLocaleDateString()}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ruolo di Anzianità:</div>
                        <div class="detail-value">${candidate.ruoloAnzianita}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Istituto di Appartenenza:</div>
                        <div class="detail-value">${candidate.istitutoAppartenenza}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Data Nascita:</div>
                        <div class="detail-value">${new Date(candidate.dataNascita).toLocaleDateString()}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Data Interpello:</div>
                        <div class="detail-value">${new Date(candidate.dataInterpello).toLocaleDateString()}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Titolo di Studio Principale:</div>
                        <div class="detail-value">${candidate.titoloStudio}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Dottorato di Ricerca:</div>
                        <div class="detail-value">${candidate.dottorato}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Numero Master di II Livello:</div>
                        <div class="detail-value">${numMasterII_display}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Numero Master di I Livello:</div>
                        <div class="detail-value">${numMasterI_display}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Anni Esperienza Specifica:</div>
                        <div class="detail-value">${candidate.anniEsperienza} anni</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Causa Servizio non Incompatibile:</div>
                        <div class="detail-value">${candidate.servizioNonIncompatibile}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Numero Attestati Corsi:</div>
                        <div class="detail-value">${candidate.attestatiCorsi}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Giudizio Anno 1:</div>
                        <div class="detail-value">${candidate.giudizioAnno1}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Giudizio Anno 2:</div>
                        <div class="detail-value">${candidate.giudizioAnno2}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Giudizio Anno 3:</div>
                        <div class="detail-value">${candidate.giudizioAnno3}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Patente A:</div>
                        <div class="detail-value">${candidate.patenteA}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Patente B:</div>
                        <div class="detail-value">${candidate.patenteB}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Patente C:</div>
                        <div class="detail-value">${candidate.patenteC}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Patente D:</div>
                        <div class="detail-value">${candidate.patenteD}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Patente E:</div>
                        <div class="detail-value">${candidate.patenteE}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Titoli:</div>
                        <div class="detail-value">${candidate.punteggioTitoli.toFixed(2)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Esperienza:</div>
                        <div class="detail-value">${candidate.punteggioEsperienza.toFixed(2)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Giudizi:</div>
                        <div class="detail-value">${candidate.punteggioGiudizi.toFixed(2)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Anzianità:</div>
                        <div class="detail-value">${candidate.punteggioAnzianita.toFixed(2)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Patenti:</div>
                        <div class="detail-value">${candidate.punteggioPatenti.toFixed(2)} <small>(Nota: B, C, D non cumulabili)</small></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Colloquio:</div>
                        <div class="detail-value">${candidate.punteggioColloquio ? candidate.punteggioColloquio.toFixed(2) : 'Non assegnato'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Punteggio Totale:</div>
                        <div class="detail-value"><strong>${candidate.punteggioTotale.toFixed(2)}</strong></div>
                    </div>
                `;

                // Mostra la modale
                document.getElementById('detailsModal').style.display = 'block';
            }

            // Funzione per modificare un candidato
            function editCandidate(id) {
                const candidate = candidates.find(c => c.id === id);
                if (!candidate) return;

                // Popola il form di modifica con i dati del candidato
                document.getElementById('editCandidateId').value = candidate.id;
                document.getElementById('editMatricola').value = candidate.matricola;
                document.getElementById('editNominativo').value = candidate.nominativo;
                document.getElementById('editDataAssunzione').value = candidate.dataAssunzione.split('T')[0];
                document.getElementById('editRuoloAnzianita').value = candidate.ruoloAnzianita;
                document.getElementById('editIstitutoAppartenenza').value = candidate.istitutoAppartenenza;
                document.getElementById('editDataNascita').value = candidate.dataNascita.split('T')[0];
                document.getElementById('editDataInterpello').value = candidate.dataInterpello.split('T')[0];
                document.getElementById('editDestinazioneRichiesta').value = candidate.destinazioneRichiesta;
                document.getElementById('editRuolo').value = candidate.ruolo;
                
                // Titoli di studio
                const punteggioDottoratoVal = candidate.dottorato === "Sì" ? 1.00 : 0;
                const numMasterII_val = candidate.numMasterII !== undefined ? candidate.numMasterII : (candidate.masterII === "Sì" ? 1 : 0);
                const numMasterI_val = candidate.numMasterI !== undefined ? candidate.numMasterI : (candidate.masterI === "Sì" ? 1 : 0);
                const punteggioMasterIIVal = numMasterII_val * 0.50;
                const punteggioMasterIVal = numMasterI_val * 0.30;
                
                const punteggioTitoloPrincipale = candidate.punteggioTitoli - punteggioDottoratoVal - punteggioMasterIIVal - punteggioMasterIVal;

                const selectTitolo = document.getElementById('editTitoloStudio');
                for (let i = 0; i < selectTitolo.options.length; i++) {
                    if (Math.abs(parseFloat(selectTitolo.options[i].value) - punteggioTitoloPrincipale) < 0.01) {
                        selectTitolo.value = selectTitolo.options[i].value;
                        break;
                    }
                }
                
                document.getElementById('editDottorato').value = candidate.dottorato === "Sì" ? "1.00" : "0";
                document.getElementById('editMasterII').value = numMasterII_val;
                document.getElementById('editMasterI').value = numMasterI_val;
                
                // Esperienza e giudizi
                document.getElementById('editAnniEsperienza').value = candidate.anniEsperienza;
                document.getElementById('editServizioNonIncompatibile').value = candidate.servizioNonIncompatibile.includes("Minimo") ? "0.25" : 
                                                                                  candidate.servizioNonIncompatibile.includes("Medio") ? "0.50" :
                                                                                  candidate.servizioNonIncompatibile.includes("Massimo") ? "0.75" : "0";
                document.getElementById('editAttestatiCorsi').value = candidate.attestatiCorsi;
                
                // Giudizi annuali
                document.getElementById('editGiudizioAnno1').value = candidate.giudizioAnno1.includes("Ottimo +") ? "0.30" : 
                                                                    candidate.giudizioAnno1.includes("Ottimo") ? "0.25" : 
                                                                    candidate.giudizioAnno1.includes("Distinto") ? "0.20" : 
                                                                    candidate.giudizioAnno1.includes("Buono") ? "0.10" : "0";
                
                document.getElementById('editGiudizioAnno2').value = candidate.giudizioAnno2.includes("Ottimo +") ? "0.30" : 
                                                                    candidate.giudizioAnno2.includes("Ottimo") ? "0.25" : 
                                                                    candidate.giudizioAnno2.includes("Distinto") ? "0.20" : 
                                                                    candidate.giudizioAnno2.includes("Buono") ? "0.10" : "0";
                
                document.getElementById('editGiudizioAnno3').value = candidate.giudizioAnno3.includes("Ottimo +") ? "0.30" : 
                                                                    candidate.giudizioAnno3.includes("Ottimo") ? "0.25" : 
                                                                    candidate.giudizioAnno3.includes("Distinto") ? "0.20" : 
                                                                    candidate.giudizioAnno3.includes("Buono") ? "0.10" : "0";
                
                // Patenti
                document.getElementById('editPatenteA').checked = candidate.patenteA === "Sì";
                document.getElementById('editPatenteB').checked = candidate.patenteB === "Sì";
                document.getElementById('editPatenteC').checked = candidate.patenteC === "Sì";
                document.getElementById('editPatenteD').checked = candidate.patenteD === "Sì";
                document.getElementById('editPatenteE').checked = candidate.patenteE === "Sì";
                
                // Punteggio colloquio
                document.getElementById('editPunteggioColloquio').value = candidate.punteggioColloquio || '';

                // Mostra la modale
                document.getElementById('editModal').style.display = 'block';
            }

            // Funzione per salvare le modifiche
            document.getElementById('saveEditBtn').addEventListener('click', function() {
                const candidateId = parseInt(document.getElementById('editCandidateId').value);
                const candidateIndex = candidates.findIndex(c => c.id === candidateId);
                
                if (candidateIndex === -1) return;
                
                // Validazione dei campi obbligatori
                const requiredFields = ['editMatricola', 'editNominativo', 'editDataAssunzione', 
                                      'editRuoloAnzianita', 'editIstitutoAppartenenza', 'editDataNascita', 'editDataInterpello', 'editDestinazioneRichiesta',
                                      'editRuolo', 'editTitoloStudio'];
                
                for (let fieldId of requiredFields) {
                    const field = document.getElementById(fieldId);
                    if (!field.value || field.value.trim() === '') {
                        alert('Per favore, compila tutti i campi obbligatori');
                        field.focus();
                        return;
                    }
                }

                // Calcola i nuovi punteggi basati sui valori modificati
                const dataAssunzione = new Date(document.getElementById('editDataAssunzione').value);
                const dataInterpello = new Date(document.getElementById('editDataInterpello').value);
                
                // Punteggio titoli di studio
                const punteggioTitoloStudio = parseFloat(document.getElementById('editTitoloStudio').value) || 0;
                const punteggioDottorato = parseFloat(document.getElementById('editDottorato').value) || 0;
                const numMasterII = parseInt(document.getElementById('editMasterII').value) || 0;
                const punteggioMasterII = numMasterII * 0.50;
                const numMasterI = parseInt(document.getElementById('editMasterI').value) || 0;
                const punteggioMasterI = numMasterI * 0.30;
                const punteggioTitoli = punteggioTitoloStudio + punteggioDottorato + punteggioMasterII + punteggioMasterI;
                
                // Punteggio esperienza
                const anniEsperienza = parseInt(document.getElementById('editAnniEsperienza').value) || 0;
                const punteggioEsperienza = Math.min(anniEsperienza * 0.20, 2.00);
                
                // Punteggio servizio non incompatibile
                const punteggioServizioNonIncompatibile = parseFloat(document.getElementById('editServizioNonIncompatibile').value) || 0;
                
                // Punteggio attestati corsi
                const numeroAttestati = parseInt(document.getElementById('editAttestatiCorsi').value) || 0;
                const punteggioAttestati = Math.min(numeroAttestati * 0.05, 0.25);
                
                // Punteggio giudizi
                const giudizioAnno1 = parseFloat(document.getElementById('editGiudizioAnno1').value) || 0;
                const giudizioAnno2 = parseFloat(document.getElementById('editGiudizioAnno2').value) || 0;
                const giudizioAnno3 = parseFloat(document.getElementById('editGiudizioAnno3').value) || 0;
                const mediaGiudizi = (giudizioAnno1 + giudizioAnno2 + giudizioAnno3) / 3;
                
                // Punteggio anzianità
                const anniServizio = Math.floor((dataInterpello - dataAssunzione) / (365.25 * 24 * 60 * 60 * 1000));
                const punteggioAnzianita = anniServizio * 0.30;
                
                // Punteggio patenti
                const punteggioPatenteA = document.getElementById('editPatenteA').checked ? 0.25 : 0;
                const punteggioPatenteB = document.getElementById('editPatenteB').checked ? 1.00 : 0;
                const punteggioPatenteC = document.getElementById('editPatenteC').checked ? 1.50 : 0;
                const punteggioPatenteD = document.getElementById('editPatenteD').checked ? 2.00 : 0;
                const punteggioPatenteE = document.getElementById('editPatenteE').checked ? 0.25 : 0;
                
                // Calcolo punteggio patenti non cumulabili
                let punteggioPatenti = 0;
                const hasPatenteBase = punteggioPatenteB > 0 || punteggioPatenteC > 0 || punteggioPatenteD > 0;
                
                if (hasPatenteBase) {
                    const punteggioPatenteBase = Math.max(punteggioPatenteB, punteggioPatenteC, punteggioPatenteD);
                    punteggioPatenti = punteggioPatenteBase + punteggioPatenteA + punteggioPatenteE;
                }
                
                // Punteggio colloquio (facoltativo)
                const punteggioColloquio = parseFloat(document.getElementById('editPunteggioColloquio').value) || 0;
                
                // Punteggio totale
                const punteggioTotale = punteggioTitoli + punteggioEsperienza + punteggioServizioNonIncompatibile + 
                                      punteggioAttestati + mediaGiudizi + punteggioAnzianita + punteggioPatenti + punteggioColloquio;

                // Aggiorna i dati del candidato
                const candidateToUpdate = candidates[candidateIndex];
                candidateToUpdate.matricola = document.getElementById('editMatricola').value;
                candidateToUpdate.nominativo = document.getElementById('editNominativo').value;
                candidateToUpdate.dataAssunzione = dataAssunzione.toISOString();
                candidateToUpdate.ruoloAnzianita = parseInt(document.getElementById('editRuoloAnzianita').value);
                candidateToUpdate.istitutoAppartenenza = document.getElementById('editIstitutoAppartenenza').value;
                candidateToUpdate.dataNascita = new Date(document.getElementById('editDataNascita').value).toISOString();
                candidateToUpdate.dataInterpello = dataInterpello.toISOString();
                candidateToUpdate.destinazioneRichiesta = document.getElementById('editDestinazioneRichiesta').value;
                candidateToUpdate.ruolo = document.getElementById('editRuolo').value;
                candidateToUpdate.punteggioTitoli = punteggioTitoli;
                candidateToUpdate.punteggioEsperienza = punteggioEsperienza;
                candidateToUpdate.punteggioGiudizi = mediaGiudizi;
                candidateToUpdate.punteggioAnzianita = punteggioAnzianita;
                candidateToUpdate.punteggioPatenti = punteggioPatenti;
                candidateToUpdate.punteggioColloquio = punteggioColloquio;
                candidateToUpdate.punteggioTotale = punteggioTotale;
                
                // Aggiorna i dettagli per la visualizzazione
                candidateToUpdate.titoloStudio = document.getElementById('editTitoloStudio').options[document.getElementById('editTitoloStudio').selectedIndex].text;
                candidateToUpdate.dottorato = document.getElementById('editDottorato').value === "1.00" ? "Sì" : "No";
                candidateToUpdate.numMasterII = numMasterII;
                candidateToUpdate.numMasterI = numMasterI;
                candidateToUpdate.anniEsperienza = anniEsperienza;
                candidateToUpdate.servizioNonIncompatibile = document.getElementById('editServizioNonIncompatibile').options[document.getElementById('editServizioNonIncompatibile').selectedIndex].text;
                candidateToUpdate.attestatiCorsi = numeroAttestati;
                candidateToUpdate.giudizioAnno1 = document.getElementById('editGiudizioAnno1').options[document.getElementById('editGiudizioAnno1').selectedIndex].text;
                candidateToUpdate.giudizioAnno2 = document.getElementById('editGiudizioAnno2').options[document.getElementById('editGiudizioAnno2').selectedIndex].text;
                candidateToUpdate.giudizioAnno3 = document.getElementById('editGiudizioAnno3').options[document.getElementById('editGiudizioAnno3').selectedIndex].text;
                candidateToUpdate.patenteA = document.getElementById('editPatenteA').checked ? "Sì" : "No";
                candidateToUpdate.patenteB = document.getElementById('editPatenteB').checked ? "Sì" : "No";
                candidateToUpdate.patenteC = document.getElementById('editPatenteC').checked ? "Sì" : "No";
                candidateToUpdate.patenteD = document.getElementById('editPatenteD').checked ? "Sì" : "No";
                candidateToUpdate.patenteE = document.getElementById('editPatenteE').checked ? "Sì" : "No";
                
                // Rimuovi le vecchie proprietà per pulizia
                if (candidateToUpdate.hasOwnProperty('masterII')) delete candidateToUpdate.masterII;
                if (candidateToUpdate.hasOwnProperty('masterI')) delete candidateToUpdate.masterI;


                // Salva e aggiorna
                localStorage.setItem('candidates', JSON.stringify(candidates));
                updateTable();
                updateGraduatoriaFinale();
                document.getElementById('editModal').style.display = 'none';
                
                // Messaggio di conferma
                alert('Modifiche salvate con successo!');
                
                // Assicurati che la tab graduatoria sia visibile per vedere le modifiche
                if (!document.getElementById('tab-graduatoria').classList.contains('active')) {
                    document.querySelector('[data-tab="tab-graduatoria"]').click();
                }
            });

            // Gestione apertura modale Privacy Policy
            document.getElementById('privacyLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('privacyModal').style.display = 'block';
            });

            // Gestione apertura modale contatti
            document.getElementById('contactLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('contactModal').style.display = 'block';
            });

            // Gestione apertura modale termini di servizio
            document.getElementById('termsLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('termsModal').style.display = 'block';
            });

            // Gestione chiusura modale Privacy Policy
            document.getElementById('closePrivacyModal').addEventListener('click', function() {
                document.getElementById('privacyModal').style.display = 'none';
            });

            document.getElementById('closePrivacyBtn').addEventListener('click', function() {
                document.getElementById('privacyModal').style.display = 'none';
            });

            // Gestione chiusura modale termini di servizio
            document.getElementById('closeTermsModal').addEventListener('click', function() {
                document.getElementById('termsModal').style.display = 'none';
            });

            document.getElementById('closeTermsBtn').addEventListener('click', function() {
                document.getElementById('termsModal').style.display = 'none';
            });

            // Gestione chiusura modale contatti
            document.getElementById('closeContactModal').addEventListener('click', function() {
                document.getElementById('contactModal').style.display = 'none';
            });

            document.getElementById('closeContactBtn').addEventListener('click', function() {
                document.getElementById('contactModal').style.display = 'none';
            });

            // Gestione chiusura modale dettagli
            document.getElementById('closeDetailsModal').addEventListener('click', function() {
                document.getElementById('detailsModal').style.display = 'none';
            });

            document.getElementById('closeDetailsBtn').addEventListener('click', function() {
                document.getElementById('detailsModal').style.display = 'none';
            });

            // Gestione chiusura modale modifica
            document.getElementById('closeEditModal').addEventListener('click', function() {
                document.getElementById('editModal').style.display = 'none';
            });

            document.getElementById('cancelEditBtn').addEventListener('click', function() {
                document.getElementById('editModal').style.display = 'none';
            });

            // Chiudi le modali cliccando fuori dall'area del contenuto
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('detailsModal')) {
                    document.getElementById('detailsModal').style.display = 'none';
                }
                if (event.target === document.getElementById('editModal')) {
                    document.getElementById('editModal').style.display = 'none';
                }
                if (event.target === document.getElementById('contactModal')) {
                    document.getElementById('contactModal').style.display = 'none';
                }
                if (event.target === document.getElementById('termsModal')) {
                    document.getElementById('termsModal').style.display = 'none';
                }
                if (event.target === document.getElementById('privacyModal')) {
                    document.getElementById('privacyModal').style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
```